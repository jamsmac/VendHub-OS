# Architecture Decision Records (ADR) для VendHub

## Что такое ADR

Architecture Decision Record - документ, фиксирующий важное архитектурное решение вместе с контекстом и последствиями.

## Когда создавать ADR

- Выбор технологии или фреймворка
- Изменение структуры базы данных
- Новый паттерн интеграции
- Значительный рефакторинг
- Решение о безопасности
- Изменение API контракта

## Шаблон ADR

```markdown
# ADR-XXX: [Заголовок решения]

## Статус

[Proposed | Accepted | Deprecated | Superseded by ADR-XXX]

## Дата

YYYY-MM-DD

## Контекст

Описание проблемы или ситуации, которая привела к необходимости принять решение.

- Какая проблема решается?
- Какие требования или ограничения существуют?
- Какой контекст важен для понимания?

## Рассмотренные варианты

### Вариант 1: [Название]

**Описание:** Краткое описание варианта.

**Плюсы:**
- Плюс 1
- Плюс 2

**Минусы:**
- Минус 1
- Минус 2

### Вариант 2: [Название]

**Описание:** Краткое описание варианта.

**Плюсы:**
- Плюс 1

**Минусы:**
- Минус 1

## Решение

Выбран **Вариант X** потому что:
1. Причина 1
2. Причина 2

## Последствия

### Положительные
- Последствие 1
- Последствие 2

### Отрицательные
- Последствие 1
- Последствие 2

### Нейтральные
- Последствие 1

## Связанные решения

- [ADR-XXX](ADR-XXX-xxx.md) - связанное решение

## Ссылки

- [Ссылка на документацию]
- [Ссылка на обсуждение]
```

## Пример ADR для VendHub

```markdown
# ADR-001: Выбор NestJS для Backend

## Статус

Accepted

## Дата

2024-01-15

## Контекст

Необходимо выбрать фреймворк для разработки backend API VendHub OS.
Система должна поддерживать:
- REST API с документацией (Swagger)
- WebSocket для real-time обновлений
- Интеграцию с PostgreSQL
- Модульную архитектуру для масштабирования
- TypeScript для type safety

## Рассмотренные варианты

### Вариант 1: Express.js + TypeScript

**Плюсы:**
- Минималистичный, гибкий
- Большое сообщество
- Много middleware

**Минусы:**
- Нет структуры из коробки
- Нужно вручную настраивать DI
- Swagger требует дополнительной настройки

### Вариант 2: NestJS

**Плюсы:**
- Готовая модульная архитектура
- Встроенный DI контейнер
- Swagger из коробки
- Поддержка WebSocket
- CLI для генерации кода
- Активное развитие

**Минусы:**
- Более крутая кривая обучения
- Больше boilerplate кода
- Может быть избыточен для простых проектов

### Вариант 3: Fastify

**Плюсы:**
- Высокая производительность
- Легче Express

**Минусы:**
- Меньше экосистема
- Нет структуры

## Решение

Выбран **NestJS** потому что:
1. Модульная архитектура идеально подходит для VendHub с его 50+ модулями
2. Встроенная поддержка Swagger критична для API documentation
3. DI контейнер упрощает тестирование
4. WebSocket gateway встроен
5. Команда имеет опыт с Angular-подобным DI

## Последствия

### Положительные
- Единообразная структура кода
- Легкое добавление новых модулей
- API документация генерируется автоматически
- Проще онбординг новых разработчиков

### Отрицательные
- Больше времени на начальную настройку
- Некоторый overhead от DI

### Нейтральные
- Необходимость следовать conventions NestJS

## Ссылки

- [NestJS Documentation](https://docs.nestjs.com/)
- [NestJS vs Express comparison](https://...)
```

## Структура папки ADR

```
docs/architecture/
├── README.md              # Индекс всех ADR
├── ADR-001-nestjs.md
├── ADR-002-typeorm.md
├── ADR-003-jwt-auth.md
├── ADR-004-rbac.md
├── ADR-005-photo-storage.md
├── ADR-006-telegram-integration.md
└── ADR-007-manual-operations.md
```

## README для индекса ADR

```markdown
# Architecture Decision Records

| ADR | Заголовок | Статус | Дата |
|-----|-----------|--------|------|
| [001](ADR-001-nestjs.md) | Выбор NestJS для Backend | Accepted | 2024-01-15 |
| [002](ADR-002-typeorm.md) | TypeORM для работы с БД | Accepted | 2024-01-16 |
| [003](ADR-003-jwt-auth.md) | JWT для аутентификации | Accepted | 2024-01-20 |
| [004](ADR-004-rbac.md) | RBAC для авторизации | Accepted | 2024-01-22 |
| [005](ADR-005-photo-storage.md) | Cloudflare R2 для хранения фото | Accepted | 2024-02-01 |
| [006](ADR-006-telegram-integration.md) | Telegram как основной канал | Accepted | 2024-02-05 |
| [007](ADR-007-manual-operations.md) | Manual-first архитектура | Accepted | 2024-02-10 |
```

## CLI для создания ADR

```bash
# scripts/create-adr.sh
#!/bin/bash

NEXT_NUMBER=$(ls docs/architecture/ADR-*.md 2>/dev/null | wc -l)
NEXT_NUMBER=$((NEXT_NUMBER + 1))
PADDED=$(printf "%03d" $NEXT_NUMBER)

TITLE=$1
SLUG=$(echo "$TITLE" | tr '[:upper:]' '[:lower:]' | tr ' ' '-')
FILENAME="docs/architecture/ADR-${PADDED}-${SLUG}.md"

cat > "$FILENAME" << EOF
# ADR-${PADDED}: ${TITLE}

## Статус

Proposed

## Дата

$(date +%Y-%m-%d)

## Контекст

[Описание проблемы]

## Рассмотренные варианты

### Вариант 1: [Название]

**Плюсы:**
-

**Минусы:**
-

## Решение

[Выбранное решение и причины]

## Последствия

### Положительные
-

### Отрицательные
-

## Ссылки

-
EOF

echo "Created: $FILENAME"
```

Использование:
```bash
./scripts/create-adr.sh "Redis для кэширования"
# Created: docs/architecture/ADR-008-redis-для-кэширования.md
```
