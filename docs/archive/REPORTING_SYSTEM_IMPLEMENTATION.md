# VendHub OS - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ v11.0

**–î–∞—Ç–∞:** 2026-01-17
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

---

## üìä –û–ë–ó–û–†

–°–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ VendHub OS —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ v11.0 —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–≤—É—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –æ—Ç—á–µ—Ç–æ–≤:

| –°—Ç—Ä—É–∫—Ç—É—Ä–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ | –õ–∏—Å—Ç–æ–≤ | –ê–∫—Ü–µ–Ω—Ç |
|-----------|----------|--------|--------|
| **A** | –ü–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π | 46 | –ù–∞–ª–∏—á–Ω—ã–µ/QR/VIP/–ö—Ä–µ–¥–∏—Ç |
| **B** | –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ | 13 | –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å/–ü—Ä–∏–±—ã–ª—å/–ú–∞—Ä–∂–∞ |
| **A+B** | –ü–æ–ª–Ω–∞—è | 64 | –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ + –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ |

---

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´

### DTOs
```
/apps/api/src/modules/reports/dto/vendhub-report.dto.ts
```

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- `PaymentResourceType` - —Ç–∏–ø—ã –ø–ª–∞—Ç–µ–∂–µ–π (CASH, QR, VIP, CREDIT, TEST)
- `BrewStatusType` - —Å—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏
- `QRPaymentSystem` - –ø–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (Payme, Click, Uzum)
- `ReportStructure` - —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç—á–µ—Ç–æ–≤ (A, B, A+B)
- `VENDHUB_INGREDIENTS` - 14 –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ —Å —Ü–µ–Ω–∞–º–∏
- `GenerateVendHubReportDto` - DTO –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
- –í—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è Structure A –∏ Structure B
- `VendHubFullReportDto` - –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
- `STRUCTURE_A_SHEETS`, `STRUCTURE_B_SHEETS` - –Ω–∞–∑–≤–∞–Ω–∏—è –ª–∏—Å—Ç–æ–≤ Excel
- `VERIFICATION_RULES` - –ø—Ä–∞–≤–∏–ª–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –°–µ—Ä–≤–∏—Å—ã

#### VendHub Report Generator Service
```
/apps/api/src/modules/reports/services/vendhub-report-generator.service.ts
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Structure A (–ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Structure B (—Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ:
  - –¢–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π
  - –ê–≤—Ç–æ–º–∞—Ç–∞–º
  - –ü—Ä–æ–¥—É–∫—Ç–∞–º
  - –ú–µ—Å—è—Ü–∞–º
  - –î–Ω—è–º –Ω–µ–¥–µ–ª–∏ (Structure A)
  - –î–∞—Ç–∞–º (Structure B)
  - –ß–∞—Å–∞–º
- –†–∞—Å—á–µ—Ç —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –ø—Ä–∏–±—ã–ª–∏
- –†–∞—Å—Ö–æ–¥ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
- –°–≤–µ—Ä–∫–∞ QR-–ø–ª–∞—Ç–µ–∂–µ–π
- –ö—Ä–æ—Å—Å-–∞–Ω–∞–ª–∏–∑ TOP-5 √ó TOP-5
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

#### VendHub Excel Export Service
```
/apps/api/src/modules/reports/services/vendhub-excel-export.service.ts
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel (.xlsx)
- –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è (–∑–∞–≥–æ–ª–æ–≤–∫–∏, —Ñ–æ—Ä–º–∞—Ç—ã —á–∏—Å–µ–ª, —Ü–≤–µ—Ç–∞)
- –í—Å–µ –ª–∏—Å—Ç—ã Structure A (46 –ª–∏—Å—Ç–æ–≤)
- –í—Å–µ –ª–∏—Å—Ç—ã Structure B (13 –ª–∏—Å—Ç–æ–≤)
- –õ–∏—Å—Ç –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–¥–ª—è FULL)
- –ê–≤—Ç–æ–ø–æ–¥–±–æ—Ä —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫
- –°—Ç–∞—Ç—É—Å—ã —Å –∏–∫–æ–Ω–∫–∞–º–∏ (‚úÖ ‚ö†Ô∏è ‚ùå)

### –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

```
/apps/api/src/modules/reports/controllers/vendhub-report.controller.ts
```

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| POST | `/reports/vendhub/generate` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ (JSON) |
| POST | `/reports/vendhub/generate/excel` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel —Ñ–∞–π–ª–∞ |
| GET | `/reports/vendhub/quick/structure-a` | –ë—ã—Å—Ç—Ä—ã–π –æ—Ç—á–µ—Ç Structure A |
| GET | `/reports/vendhub/quick/structure-b` | –ë—ã—Å—Ç—Ä—ã–π –æ—Ç—á–µ—Ç Structure B |
| GET | `/reports/vendhub/quick/full` | –ë—ã—Å—Ç—Ä—ã–π –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç |
| GET | `/reports/vendhub/payment-types` | –°–≤–æ–¥–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π |
| GET | `/reports/vendhub/financial` | –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ |
| GET | `/reports/vendhub/qr-reconciliation` | –°–≤–µ—Ä–∫–∞ QR-–ø–ª–∞—Ç–µ–∂–µ–π |
| GET | `/reports/vendhub/ingredients` | –†–∞—Å—Ö–æ–¥ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ |
| GET | `/reports/vendhub/delivery-failures` | –°–±–æ–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ |
| GET | `/reports/vendhub/cross-analysis` | –ö—Ä–æ—Å—Å-–∞–Ω–∞–ª–∏–∑ |
| GET | `/reports/vendhub/structures` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö |

---

## üîê –ü–†–ê–í–ê –î–û–°–¢–£–ü–ê

| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –†–æ–ª–∏ |
|----------|------|
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ | owner, admin, manager, accountant |
| –°–≤–µ—Ä–∫–∞ QR | owner, admin, accountant |
| –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã | owner, admin, manager, warehouse |
| –°–±–æ–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ | owner, admin, manager, operator |
| –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö | –í—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ |

---

## ‚ö†Ô∏è –ö–õ–Æ–ß–ï–í–´–ï –û–¢–õ–ò–ß–ò–Ø –°–¢–†–£–ö–¢–£–†

### –ü–æ_–¥–Ω—è–º
- **Structure A**: –ü–æ –î–ù–Ø–ú –ù–ï–î–ï–õ–ò (7 —Å—Ç—Ä–æ–∫: –ü–Ω-–í—Å)
- **Structure B**: –ü–æ –î–ê–¢–ê–ú (–º–Ω–æ–≥–æ —Å—Ç—Ä–æ–∫)

### –ü—Ä–æ–¥—É–∫—Ç—ã
- **Structure A**: –ë–ï–ó –∫–æ–ª–æ–Ω–∫–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
- **Structure B**: –ï–°–¢–¨ –∫–æ–ª–æ–Ω–∫–∞ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è" –∏ "–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å/–µ–¥."

### –§–∏–Ω–∞–Ω—Å—ã
- **Structure A**: –ù–ï–¢ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏, –ø—Ä–∏–±—ã–ª–∏, –º–∞—Ä–∂–∏
- **Structure B**: –ï–°–¢–¨ –≤—Å–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

### –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
- **Structure A**: –ù–ï–¢
- **Structure B**: –ï–°–¢–¨ (5 –ª–∏—Å—Ç–æ–≤)

---

## üìã –ü–†–ê–í–ò–õ–ê –í–ï–†–ò–§–ò–ö–ê–¶–ò–ò

### –ß—Ç–µ–Ω–∏–µ Payme —Ñ–∞–π–ª–æ–≤
- Header row: **6** (–Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π!)
- –°—É–º–º–∞ –¥–ª—è —Å–≤–µ—Ä–∫–∏: –∫–æ–ª–æ–Ω–∫–∞ **"–°–£–ú–ú–ê –ë–ï–ó –ö–û–ú–ò–°–°–ò–ò"**

### –°–≤–µ—Ä–∫–∞ QR
- –ü—Ä–∏–Ω—Ü–∏–ø: `Order[–¢–∞–º–æ–∂–µ–Ω–Ω—ã–π –ø–ª–∞—Ç–µ–∂] ‚âà Payme + Click`
- –î–æ–ø—É—Å–∫–∏:
  - ‚úÖ OK: < 1%
  - ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: 1-3%
  - ‚ùå –ö—Ä–∏—Ç–∏—á–Ω–æ: > 3%

### –§–∏–ª—å—Ç—Ä—ã
- –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã: `brew_status IN ('–î–æ—Å—Ç–∞–≤–ª–µ–Ω', '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞')`
- –û–ø–ª–∞—Ç–∞: `payment_status = '–û–ø–ª–∞—á–µ–Ω–æ'`

---

## üß™ –ü–†–ò–ú–ï–† –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ (JSON)
```typescript
POST /api/reports/vendhub/generate
{
  "dateFrom": "2025-01-01",
  "dateTo": "2025-01-31",
  "structure": "A+B",
  "language": "ru"
}
```

### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ Excel —Ñ–∞–π–ª–∞
```typescript
POST /api/reports/vendhub/generate/excel
{
  "dateFrom": "2025-01-01",
  "dateTo": "2025-01-31",
  "structure": "A+B"
}
// Response: Excel file download
```

### –ë—ã—Å—Ç—Ä—ã–π –æ—Ç—á–µ—Ç –∑–∞ 30 –¥–Ω–µ–π
```typescript
GET /api/reports/vendhub/quick/full?days=30
```

### –°–≤–µ—Ä–∫–∞ QR-–ø–ª–∞—Ç–µ–∂–µ–π
```typescript
GET /api/reports/vendhub/qr-reconciliation?dateFrom=2025-01-01&dateTo=2025-01-31
```

---

## üì¶ –ó–ê–í–ò–°–ò–ú–û–°–¢–ò

```json
{
  "exceljs": "^4.4.0"
}
```

---

## üöÄ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

### –í Reports Module
```typescript
import { VendHubReportGeneratorService } from './services/vendhub-report-generator.service';
import { VendHubExcelExportService } from './services/vendhub-excel-export.service';

@Module({
  providers: [
    VendHubReportGeneratorService,
    VendHubExcelExportService,
  ],
})
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
```typescript
import { VendHubReportGeneratorService } from '../reports';

@Injectable()
export class MyService {
  constructor(private readonly reportGenerator: VendHubReportGeneratorService) {}

  async generateReport() {
    return this.reportGenerator.generate(organizationId, {
      dateFrom: '2025-01-01',
      dateTo: '2025-01-31',
      structure: ReportStructure.FULL,
    });
  }
}
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

- [x] DTOs –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ v11.0
- [x] –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä Structure A
- [x] –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä Structure B
- [x] –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (FULL)
- [x] Excel —ç–∫—Å–ø–æ—Ä—Ç
- [x] API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- [x] –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º
- [x] –°–≤–µ—Ä–∫–∞ QR-–ø–ª–∞—Ç–µ–∂–µ–π
- [x] –†–∞—Å—Ö–æ–¥ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
- [x] –ö—Ä–æ—Å—Å-–∞–Ω–∞–ª–∏–∑
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

*–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ v11.0*
