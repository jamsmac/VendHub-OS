# ПРОМТ: Генерация полного и окончательного описания интерфейса VendHub OS

**Версия:** 1.0
**Дата:** 26 января 2026
**Назначение:** Создание исчерпывающей документации UI/UX на основе всех наработок проекта

---

## 🎯 ЗАДАЧА

Ты — опытный технический писатель и UI/UX архитектор. Твоя задача — создать **ФИНАЛЬНУЮ, ПОЛНУЮ и ДЕТАЛЬНУЮ документацию интерфейса** платформы VendHub OS (кодовое имя VHM24).

Документ должен быть:
- **Исчерпывающим** — каждый экран, каждый компонент, каждое состояние
- **Структурированным** — чёткая иерархия разделов
- **Практичным** — готов к использованию разработчиками и дизайнерами
- **Согласованным** — единая терминология и стиль

---

## 📚 КОНТЕКСТ ПРОЕКТА

### Что такое VendHub OS:
Платформа управления вендинговым бизнесом, включающая:
- Кофейные и снековые автоматы
- Управление товарами, рецептурами, ценами
- Операции: загрузки, инвентаризация, техобслуживание
- Финансы: платежи, фискализация, отчётность
- Клиентский сервис: приложение, лояльность, заказы

### Четыре интерфейса системы:

| Интерфейс | Технология | Пользователи | Назначение |
|-----------|------------|--------------|------------|
| **Admin Dashboard** | Next.js 16, shadcn/ui | Owner, Admin, Manager, Accountant | Полное управление бизнесом |
| **Staff App** | React Native + PWA | Operator, Technician, Warehouse | Мобильные операции |
| **Client App** | Vite + React (TWA) | Покупатели | Заказы, оплата, лояльность |
| **Investor Portal** | Next.js | Инвесторы, Франчайзи | Мониторинг ROI |

### Система ролей (RBAC):
```
OWNER        — Полный доступ ко всему
ADMIN        — Управление без биллинга
MANAGER      — Операционное управление
ACCOUNTANT   — Финансы и отчётность
OPERATOR     — Загрузки и маршруты
TECHNICIAN   — Техобслуживание
WAREHOUSE    — Склад
```

---

## 📋 СТРУКТУРА ВЫХОДНОГО ДОКУМЕНТА

Сгенерируй документ следующей структуры:

```markdown
# VendHub OS — Полное описание интерфейса
## Версия: 1.0 | Дата: [текущая дата]

---

# ЧАСТЬ 1: ОБЗОР ПЛАТФОРМЫ

## 1.1 Архитектура интерфейсов
[Описание 4 интерфейсов с их целями и аудиторией]

## 1.2 Технологический стек
- Frontend: Next.js 16, React Native, Vite + React
- UI библиотеки: shadcn/ui, Radix UI, Tailwind CSS
- Состояние: Zustand, React Query
- Design system: "Warm Brew"

## 1.3 Система ролей и доступа
[7 ролей с матрицей доступа к разделам]

## 1.4 Общие принципы UI
- Responsive design (desktop, tablet, mobile)
- Offline-first для Staff App
- OFFICIAL/LOCAL разделение данных
- Единый язык компонентов

---

# ЧАСТЬ 2: ADMIN DASHBOARD

## 2.1 Навигация и лейаут

### Sidebar структура:
[Полное дерево навигации с иконками и путями]

### Header элементы:
- Logo + Organization selector
- Global search (⌘K)
- Notifications bell
- User menu

### Responsive поведение:
- Desktop (>1024px): Expanded sidebar
- Tablet (768-1024px): Collapsed sidebar (icons)
- Mobile (<768px): Hidden sidebar (Sheet)

## 2.2 Dashboard — Главная

### Путь: `/dashboard`
### Назначение: Обзор ключевых метрик и быстрые действия
### Роли: Все

### Компоненты:
1. **StatCards** — 4-6 карточек KPI
   - Продажи сегодня (сумма, +/- vs вчера)
   - Активные автоматы (кол-во, % онлайн)
   - Задачи на сегодня (выполнено/всего)
   - Алерты (критичные/предупреждения)

2. **SalesChart** — График продаж (Recharts)
   - Период: день/неделя/месяц
   - Линия: сумма, количество
   - Сравнение с предыдущим периодом

3. **RecentActivity** — Лента событий
   - Продажи, загрузки, инциденты
   - Время + иконка + описание
   - Click → детали

4. **QuickActions** — Быстрые действия
   - Создать задачу
   - Добавить товар
   - Открыть карту

### Состояния:
- Loading: Skeleton карточек
- Empty: Welcome message для новых пользователей
- Error: Error boundary с retry

[Продолжить для КАЖДОГО экрана Admin Dashboard...]

---

# ЧАСТЬ 3: MASTER DATA MANAGEMENT (MDM)

## 3.1 Концепция справочников

### Типы справочников:
| Тип | Описание | Пример | Inline create |
|-----|----------|--------|---------------|
| MANUAL | Создаётся пользователем | Товары, Контрагенты | Да |
| EXTERNAL | Синхронизируется извне | ИКПУ, Курсы валют | Нет |
| PARAM | Системные параметры | Ед. измерения, НДС | По настройке |
| TEMPLATE | Шаблоны документов | Шаблоны договоров | Нет |

### Происхождение записей:
- **OFFICIAL** 🛡️ — Из внешнего источника, read-only
- **LOCAL** ✍️ — Создано пользователем, editable

## 3.2 Directory Builder Wizard

### Путь: `/dashboard/directories/create`
### Назначение: Создание нового справочника за 6 шагов

### Step 1: Выбор типа
**UI:** 4 карточки с иконками
- MANUAL — Редактируемый справочник
- EXTERNAL — С внешним источником
- PARAM — Системный параметр
- TEMPLATE — Шаблоны

**Wireframe:**
```
┌─────────────────────────────────────────────────┐
│  Выберите тип справочника                       │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────┐│
│  │ 📝      │  │ 🔄      │  │ ⚙️      │  │ 📋 ││
│  │ MANUAL  │  │ EXTERNAL│  │ PARAM   │  │TEMPL││
│  │         │  │         │  │         │  │     ││
│  │ Редакт. │  │ Внешний │  │ Системн.│  │ Шабл││
│  └─────────┘  └─────────┘  └─────────┘  └─────┘│
│                                                 │
│                            [Отмена]  [Далее →] │
└─────────────────────────────────────────────────┘
```

### Step 2: Базовая информация
**Поля:**
- Название (ru, uz, en) — обязательное
- Slug (auto-generate from name) — уникальный
- Описание — опциональное
- Scope: HQ | ORGANIZATION | LOCATION
- Иконка — IconPicker

### Step 3: Конструктор полей (Field Builder)
**UI:** Drag-and-drop список + Live Preview справа

**Доступные типы полей:**
| Тип | Иконка | Описание | Валидация |
|-----|--------|----------|-----------|
| TEXT | Aa | Текстовое поле | regex, min/max length |
| NUMBER | 123 | Числовое | min/max value |
| DATE | 📅 | Дата | min/max date |
| DATETIME | 🕐 | Дата и время | — |
| BOOLEAN | ☑️ | Да/Нет | — |
| SELECT_SINGLE | ▼ | Выбор одного | allowed_values |
| SELECT_MULTI | ☐☐ | Множественный выбор | allowed_values |
| REF | 🔗 | Ссылка на справочник | target directory |
| JSON | {} | JSON объект | schema |
| FILE | 📎 | Файл | extensions, max_size |
| IMAGE | 🖼️ | Изображение | extensions, dimensions |

**Каждое поле настраивается:**
- Название (локализованное)
- Ключ (slug)
- Обязательность
- Значение по умолчанию
- Правила валидации

### Step 4: Источник данных (только EXTERNAL)
**Поля:**
- URL источника
- Тип: URL | API | FILE
- Формат: JSON | XML | CSV
- Auth config (5 типов)
- Маппинг полей
- Cron расписание

### Step 5: Настройки
**Чекбоксы:**
- [ ] Разрешить inline создание
- [ ] Разрешить локальные записи (overlay)
- [ ] Требовать одобрение
- [ ] Включить offline режим
- [ ] Prefetch при загрузке
- [ ] Иерархический справочник

### Step 6: Права доступа
**UI:** Матрица ролей × действий

```
              VIEW  CREATE  EDIT  DELETE  IMPORT  EXPORT
OWNER          ✓      ✓      ✓      ✓       ✓       ✓
ADMIN          ✓      ✓      ✓      ✓       ✓       ✓
MANAGER        ✓      ✓      ✓      ○       ✓       ✓
ACCOUNTANT     ✓      ○      ○      ○       ○       ✓
OPERATOR       ✓      ○      ○      ○       ○       ○
```

## 3.3 DirectorySelect компонент

### Назначение: Универсальный выбор записи из справочника

### Props:
```typescript
interface DirectorySelectProps {
  directorySlug: string;      // Какой справочник
  value?: string;             // Выбранный ID
  onChange: (id: string) => void;
  allowCreate?: boolean;      // Показывать inline create
  showRecent?: boolean;       // Показывать недавние
  filter?: object;            // Дополнительные фильтры
  disabled?: boolean;
  placeholder?: string;
}
```

### Состояния UI:

**1. Closed (по умолчанию)**
```
┌──────────────────────────────────┐
│ 🛡️ Coca-Cola 0.5л           ▼  │
└──────────────────────────────────┘
```

**2. Open / Empty (нет ввода)**
```
┌──────────────────────────────────┐
│ Поиск...                     ▼  │
├──────────────────────────────────┤
│ НЕДАВНИЕ                         │
│ ├─ 🛡️ Coca-Cola 0.5л            │
│ ├─ ✍️ Fanta 0.5л                 │
│ └─ 🛡️ Pepsi 0.5л                │
└──────────────────────────────────┘
```

**3. Open / Searching**
```
┌──────────────────────────────────┐
│ fant                          ⏳ │
├──────────────────────────────────┤
│ Поиск...                         │
└──────────────────────────────────┘
```

**4. Open / Results**
```
┌──────────────────────────────────┐
│ fant                          ✕ │
├──────────────────────────────────┤
│ ОФИЦИАЛЬНЫЕ (OFFICIAL)           │
│ └─ 🛡️ Fanta Orange 0.5л         │
│                                  │
│ ЛОКАЛЬНЫЕ (LOCAL)                │
│ ├─ ✍️ Fanta Лимон 0.33л         │
│ └─ ✍️ Fanta Виноград 0.5л       │
└──────────────────────────────────┘
```

**5. Open / No Results + Inline Create**
```
┌──────────────────────────────────┐
│ новый напиток               ✕   │
├──────────────────────────────────┤
│ Ничего не найдено                │
│                                  │
│ [+ Создать "новый напиток"]      │
└──────────────────────────────────┘
```

**6. Open / Creating (inline form)**
```
┌──────────────────────────────────┐
│ Создание записи                  │
├──────────────────────────────────┤
│ Название: [новый напиток    ]    │
│ Категория: [Напитки        ▼]    │
│ Цена: [0                    ]    │
│                                  │
│         [Отмена]  [Создать]      │
└──────────────────────────────────┘
```

## 3.4 EntryCard компонент

### Путь: `/dashboard/directories/[slug]/[id]`
### Назначение: Просмотр и редактирование записи справочника

### Layout:
```
┌─────────────────────────────────────────────────────┐
│ ← Назад к списку                                    │
├─────────────────────────────────────────────────────┤
│                                                     │
│  🛡️ OFFICIAL                   [Редактировать]     │
│                                                     │
│  ╔═══════════════════════════════════════════════╗ │
│  ║  🖼️ Фото                                      ║ │
│  ║                                               ║ │
│  ║  Coca-Cola 0.5л                              ║ │
│  ║  ID: PRD-001234                               ║ │
│  ╚═══════════════════════════════════════════════╝ │
│                                                     │
│  ┌─────┬─────┬─────┬─────┐                         │
│  │Info │Recipe│Price│Audit│                        │
│  └─────┴─────┴─────┴─────┘                         │
│                                                     │
│  Категория:     Напитки газированные               │
│  Код ИКПУ:      17101001001001                     │
│  Штрих-код:     4607123456789                      │
│  Объём:         0.5 л                              │
│  Срок годности: 180 дней                           │
│  Температура:   +2°C ... +25°C                     │
│  НДС:           12%                                │
│  Статус:        ● ACTIVE                           │
│                                                     │
│  Создано:       15.01.2025 10:30 (Иванов И.И.)     │
│  Обновлено:     20.01.2025 14:45 (Петров П.П.)     │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### Вкладки:
1. **Info** — Основные поля записи
2. **Recipe** (для напитков) — Рецептура с калькуляцией
3. **Price** — Ценообразование и маржа
4. **Audit** — История изменений

[Продолжить детальное описание для КАЖДОГО компонента MDM...]

---

# ЧАСТЬ 4: ТОВАРЫ И НОМЕНКЛАТУРА

## 4.1 Два типа товаров

### Напитки (🍵 Beverages)
**Логика ценообразования:** Себестоимость = Σ(ингредиент × дозировка)

**Карточка напитка:**
```
┌─────────────────────────────────────────────────┐
│ Капучино                           [Edit] [···]│
├─────────────────────────────────────────────────┤
│  🖼️                                            │
│                                                 │
│  Категория: Кофейные напитки                   │
│  Объём: 200 мл                                 │
│                                                 │
│  ═══ РЕЦЕПТУРА ═══                             │
│  ┌─────────────────┬────────┬─────────┐        │
│  │ Ингредиент      │ Доза   │ Цена    │        │
│  ├─────────────────┼────────┼─────────┤        │
│  │ Кофе зерно      │ 8 г    │ 800 сум │        │
│  │ Молоко          │ 150 мл │ 600 сум │        │
│  │ Вода            │ 50 мл  │ 10 сум  │        │
│  │ Стаканчик       │ 1 шт   │ 200 сум │        │
│  ├─────────────────┼────────┼─────────┤        │
│  │ СЕБЕСТОИМОСТЬ   │        │1,610 сум│        │
│  └─────────────────┴────────┴─────────┘        │
│                                                 │
│  Цена продажи:    5,000 сум                    │
│  Маржа:           3,390 сум (210%)             │
│                                                 │
└─────────────────────────────────────────────────┘
```

### Снеки (🍫 Snacks)
**Логика ценообразования:** Цена = Закупка + Наценка%

**Карточка снека:**
```
┌─────────────────────────────────────────────────┐
│ Snickers 50г                       [Edit] [···]│
├─────────────────────────────────────────────────┤
│  🖼️                                            │
│                                                 │
│  Категория: Шоколадные батончики               │
│  Штрих-код: 4607123456789                      │
│  Код ИКПУ: 17101001001001                      │
│                                                 │
│  ═══ ЦЕНООБРАЗОВАНИЕ ═══                       │
│  Закупочная цена:   3,500 сум                  │
│  Наценка:           40%                        │
│  ─────────────────────────                     │
│  Цена продажи:      4,900 сум                  │
│  Маржа:             1,400 сум                  │
│                                                 │
│  Поставщик: ООО «Дистрибьютор»                 │
│  Мин. остаток: 10 шт                           │
│                                                 │
└─────────────────────────────────────────────────┘
```

[Продолжить для склада, операций, финансов...]

---

# ЧАСТЬ 5: ОБОРУДОВАНИЕ

## 5.1 Модули оборудования

### Бункеры (Bunkers)
**Назначение:** Контейнеры для ингредиентов в кофемашинах

**Поля:**
| Поле | Тип | Описание |
|------|-----|----------|
| capacity | number | Максимальная ёмкость (г/мл) |
| currentLevel | number | Текущий уровень |
| ingredientId | ref | Связь с ингредиентом |
| lastRefillDate | datetime | Последняя загрузка |
| lowLevelThreshold | number | Порог алерта |

**Визуализация в карточке автомата:**
```
┌─────────────────────────────────────┐
│ БУНКЕРЫ                             │
├─────────────────────────────────────┤
│                                     │
│  ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐    │
│  │███│ │▓▓▓│ │▓░░│ │░░░│ │▓▓▓│    │
│  │███│ │▓▓▓│ │░░░│ │░░░│ │▓▓░│    │
│  │███│ │▓░░│ │░░░│ │░░░│ │░░░│    │
│  └───┘ └───┘ └───┘ └───┘ └───┘    │
│  Кофе  Молоко Какао Сахар Стакан  │
│  95%   65%    25%⚠️  10%🔴  70%    │
│                                     │
└─────────────────────────────────────┘
```

### Кофемолки (Grinders)
| Поле | Тип | Описание |
|------|-----|----------|
| grindLevel | number | Степень помола (1-10) |
| totalGrinds | number | Всего помолов (счётчик) |
| lastMaintenance | datetime | Последнее ТО |
| maintenanceInterval | number | Интервал ТО (помолов) |

### Камеры (Cameras)
| Поле | Тип | Описание |
|------|-----|----------|
| streamUrl | string | URL видеопотока |
| isActive | boolean | Активна ли камера |
| lastCapture | datetime | Последний снимок |
| storageUsed | number | Использовано хранилища |

### SIM-карты
| Поле | Тип | Описание |
|------|-----|----------|
| operator | select | Оператор (Beeline, Ucell, etc) |
| phoneNumber | string | Номер телефона |
| dataUsage | number | Использовано трафика (MB) |
| dataLimit | number | Лимит трафика |
| expiryDate | date | Дата окончания |

## 5.2 Телеметрия варок (Brew Telemetry)

### Путь: `/dashboard/machines/[id]/brews`
### Назначение: История и аналитика варок кофе

**Структура записи варки:**
```json
{
  "id": "brew_uuid",
  "machineId": "machine_uuid",
  "productId": "product_uuid",
  "timestamp": "2025-01-26T10:30:00Z",
  "duration": 45,
  "telemetry": {
    "waterTemp": 92.5,
    "coffeeDose": 8.2,
    "milkDose": 150,
    "sugarDose": 5,
    "pressure": 9.2,
    "grindLevel": 6
  },
  "paymentMethod": "card",
  "transactionId": "txn_uuid",
  "status": "SUCCESS"
}
```

**UI таблицы варок:**
```
┌──────────────────────────────────────────────────────────────┐
│ История варок                        [Фильтры] [Экспорт]    │
├──────────────────────────────────────────────────────────────┤
│ Время      │ Напиток    │ Вода  │ Кофе │ Давл.│ Оплата     │
├────────────┼────────────┼───────┼──────┼──────┼────────────┤
│ 10:30:15   │ Капучино   │ 92.5° │ 8.2г │ 9.2  │ 💳 5000    │
│ 10:28:45   │ Американо  │ 93.1° │ 7.8г │ 9.0  │ 💵 4000    │
│ 10:25:12   │ Латте      │ 91.8° │ 8.0г │ 9.1  │ 📱 6000    │
└──────────────────────────────────────────────────────────────┘
```

---

# ЧАСТЬ 6: СКЛАД И ДВИЖЕНИЯ

## 6.1 Трёхуровневый инвентарь

```
┌─────────────────────────────────────────────────────────┐
│                      СКЛАД (Warehouse)                  │
│                         ⬇️ INCOMING                      │
│  ┌─────────────────────────────────────────────────┐   │
│  │                 Центральный склад               │   │
│  │  Coca-Cola: 500 шт | Snickers: 200 шт | ...    │   │
│  └─────────────────────────────────────────────────┘   │
│                         ⬇️ DISTRIBUTION                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │  Оператор 1  │  │  Оператор 2  │  │  Оператор 3  │  │
│  │  Coca: 50    │  │  Coca: 30    │  │  Coca: 40    │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
│         ⬇️ REFILL        ⬇️ REFILL        ⬇️ REFILL     │
│  ┌────┐ ┌────┐    ┌────┐ ┌────┐    ┌────┐ ┌────┐     │
│  │VM-1│ │VM-2│    │VM-3│ │VM-4│    │VM-5│ │VM-6│     │
│  │ 10 │ │ 8  │    │ 12 │ │ 5  │    │ 15 │ │ 7  │     │
│  └────┘ └────┘    └────┘ └────┘    └────┘ └────┘     │
└─────────────────────────────────────────────────────────┘
```

## 6.2 Типы движений

| Тип | Направление | Описание |
|-----|-------------|----------|
| INCOMING | → Склад | Приёмка от поставщика |
| REFILL | Оператор → Машина | Загрузка автомата |
| WRITEOFF | Любой → ∅ | Списание (брак, кража, истёк срок) |
| TRANSFER | Локация → Локация | Перемещение между складами |
| BUNKER_MOVE | Бункер → Бункер | Перемещение ингредиента |

---

# ЧАСТЬ 7: STAFF APP (Мобильное приложение)

## 7.1 Bottom Tab Navigation

```
┌────────────────────────────────────────────────────────┐
│                                                        │
│                    [Контент экрана]                    │
│                                                        │
├────────────────────────────────────────────────────────┤
│  📋        🗺️        📦        👤                     │
│ Задачи    Карта   Инвентарь  Профиль                  │
└────────────────────────────────────────────────────────┘
```

## 7.2 Экраны Staff App

### /tasks — Список задач
**Назначение:** Задачи оператора на сегодня
**Offline:** ✅ Полная синхронизация

```
┌────────────────────────────────────────────────────────┐
│ Задачи на сегодня                    [+] [Фильтр]     │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 🔴 СРОЧНО         09:00                         │ │
│  │ Загрузка VM-001 (ТЦ Мега)                       │ │
│  │ Coca-Cola, Fanta, Snickers                      │ │
│  │                              [Начать →]         │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 🟡 ОБЫЧНАЯ        11:30                         │ │
│  │ Инвентаризация VM-005 (БЦ Пойтахт)              │ │
│  │                              [Начать →]         │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 🟢 ВЫПОЛНЕНО      08:15                         │ │
│  │ ✓ Инкассация VM-003                             │ │
│  │ Собрано: 450,000 сум                            │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
└────────────────────────────────────────────────────────┘
```

### /tasks/[id] — Выполнение задачи
**Чеклист выполнения:**
```
┌────────────────────────────────────────────────────────┐
│ ← Загрузка VM-001                                     │
├────────────────────────────────────────────────────────┤
│                                                        │
│  📍 ТЦ Мега, 2 этаж у эскалатора                      │
│  [Навигация]                                          │
│                                                        │
│  ═══ ЧЕКЛИСТ ═══                                      │
│  ☑️ Сделать фото ДО                                   │
│  ☐ Загрузить Coca-Cola (20 шт)                        │
│  ☐ Загрузить Fanta (15 шт)                            │
│  ☐ Загрузить Snickers (25 шт)                         │
│  ☐ Проверить сдачу                                    │
│  ☐ Сделать фото ПОСЛЕ                                 │
│                                                        │
│  ═══ ФОТО ═══                                         │
│  ┌─────────┐  ┌─────────┐                             │
│  │   ДО    │  │ ПОСЛЕ   │                             │
│  │  [📷]   │  │  [📷]   │                             │
│  └─────────┘  └─────────┘                             │
│                                                        │
│  [        ЗАВЕРШИТЬ ЗАДАЧУ        ]                   │
│                                                        │
└────────────────────────────────────────────────────────┘
```

## 7.3 Offline режим

### Архитектура:
```
┌─────────────────┐     ┌─────────────────┐
│   IndexedDB     │────▶│   Sync Queue    │
│  (Local Data)   │     │  (Pending Ops)  │
└─────────────────┘     └────────┬────────┘
                                 │
                        ┌────────▼────────┐
                        │  Network Check  │
                        └────────┬────────┘
                                 │
              ┌──────────────────┼──────────────────┐
              │ Online           │ Offline          │
              ▼                  ▼                  │
     ┌────────────────┐  ┌────────────────┐        │
     │  Sync to API   │  │  Queue locally │        │
     │  + Pull updates│  │  Show indicator│        │
     └────────────────┘  └────────────────┘        │
```

### Conflict Resolution UI:
```
┌────────────────────────────────────────────────────────┐
│ ⚠️ Конфликт данных                                    │
├────────────────────────────────────────────────────────┤
│                                                        │
│ Запись: Coca-Cola 0.5л                                │
│ Поле: Цена                                            │
│                                                        │
│ ┌─────────────────┐  ┌─────────────────┐              │
│ │ ЛОКАЛЬНАЯ       │  │ СЕРВЕРНАЯ       │              │
│ │ 5,000 сум       │  │ 5,500 сум       │              │
│ │ (ваши изменения)│  │ (Иванов И.И.)   │              │
│ └─────────────────┘  └─────────────────┘              │
│                                                        │
│ [Оставить мои]  [Принять серверные]  [Объединить]    │
│                                                        │
└────────────────────────────────────────────────────────┘
```

---

# ЧАСТЬ 8: CLIENT APP

## 8.1 Главный экран
```
┌────────────────────────────────────────────────────────┐
│ 👋 Привет, Алишер!              🔔 ⚙️               │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │  ☕ 750 баллов        🔥 15 дней подряд         │ │
│  │  ████████░░ до Gold                              │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│  📍 Ближайшие автоматы                                │
│  ┌────────┐ ┌────────┐ ┌────────┐                    │
│  │ ТЦ Мега│ │БЦ Пойт.│ │ Метро  │                    │
│  │ 150м   │ │ 300м   │ │ 500м   │                    │
│  └────────┘ └────────┘ └────────┘                    │
│                                                        │
│  ⭐ Для вас                                           │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 🎁 Бесплатный кофе при заказе от 20,000!        │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│  🕐 Последние заказы                                  │
│  ┌──────────────────────────────────────────────────┐ │
│  │ Капучино • вчера 18:30 • 5,000 сум    [Повтор]  │ │
│  │ Латте • 23.01 12:15 • 6,000 сум       [Повтор]  │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
└────────────────────────────────────────────────────────┘
```

## 8.2 Программа лояльности

### Уровни:
| Уровень | Баллы | Cashback | Бонусы |
|---------|-------|----------|--------|
| Bronze | 0+ | 3% | — |
| Silver | 500+ | 5% | День рождения +100 |
| Gold | 2000+ | 7% | Приоритетная поддержка |
| Platinum | 5000+ | 10% | VIP акции |

### Streaks (серии):
- 🔥 **Daily streak** — покупки подряд (дни)
- ☕ **Coffee lover** — 10 кофе за неделю
- 🎯 **Explorer** — покупка в 5 разных автоматах

---

# ЧАСТЬ 9: ИМПОРТ И ЭКСПОРТ

## 9.1 AI Import Wizard

### 7 AI-агентов:
1. **Document Classification Agent** — определение типа файла
2. **Schema Mapping Agent** — сопоставление колонок
3. **Data Extraction Agent** — извлечение данных
4. **Validation Agent** — проверка данных
5. **Reference Resolution Agent** — fuzzy matching ссылок
6. **Reconciliation Agent** — сверка дубликатов
7. **Learning Agent** — улучшение со временем

### UI шагов:

**Step 1: Upload**
```
┌────────────────────────────────────────────────────────┐
│ Импорт записей                              Step 1/4  │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │                                                  │ │
│  │         📁 Перетащите файл сюда                 │ │
│  │              или                                │ │
│  │         [Выбрать файл]                          │ │
│  │                                                  │ │
│  │    Поддерживаются: .xlsx, .csv, .json           │ │
│  │                                                  │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│  Режим импорта:                                       │
│  ○ Только создание (CREATE_ONLY)                      │
│  ● Создание и обновление (UPSERT)                     │
│  ○ Только обновление (UPDATE_ONLY)                    │
│  ○ Тестовый прогон (DRY_RUN)                          │
│                                                        │
└────────────────────────────────────────────────────────┘
```

**Step 2: Mapping**
```
┌────────────────────────────────────────────────────────┐
│ Сопоставление колонок                      Step 2/4   │
├────────────────────────────────────────────────────────┤
│                                                        │
│  Колонка файла        →    Поле справочника           │
│  ─────────────────────────────────────────────────    │
│  "Наименование"       →    name ✓ (автоопределено)    │
│  "Артикул"            →    [code          ▼]          │
│  "Цена закупки"       →    [cost_price    ▼]          │
│  "Цена продажи"       →    [price         ▼]          │
│  "Категория"          →    [category_id   ▼] 🔗       │
│  "Неизвестная"        →    [— Пропустить —▼]          │
│                                                        │
│  🔗 = Будет fuzzy matching для связей                 │
│                                                        │
│                            [← Назад]  [Далее →]       │
└────────────────────────────────────────────────────────┘
```

**Step 3: Preview**
```
┌────────────────────────────────────────────────────────┐
│ Предпросмотр (первые 10 строк)             Step 3/4   │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ✅ 847 записей готовы к импорту                      │
│  ⚠️ 12 записей с предупреждениями                     │
│  ❌ 3 записи с ошибками                               │
│                                                        │
│  ┌─────┬────────────┬────────┬────────┬────────────┐ │
│  │ #   │ Название   │ Цена   │ Статус │ Действие   │ │
│  ├─────┼────────────┼────────┼────────┼────────────┤ │
│  │ 1   │ Coca-Cola  │ 5000   │ ✅     │ CREATE     │ │
│  │ 2   │ Pepsi      │ 4800   │ ✅     │ UPDATE     │ │
│  │ 3   │ Fanta      │ -100   │ ❌     │ SKIP       │ │
│  │     │            │ ↳ Цена не может быть < 0     │ │
│  │ 4   │ Sprite     │ 4500   │ ⚠️     │ CREATE     │ │
│  │     │            │ ↳ Категория не найдена       │ │
│  └─────┴────────────┴────────┴────────┴────────────┘ │
│                                                        │
│                            [← Назад]  [Импорт →]      │
└────────────────────────────────────────────────────────┘
```

**Step 4: Processing**
```
┌────────────────────────────────────────────────────────┐
│ Импорт выполняется...                      Step 4/4   │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ████████████████████░░░░░░░░░░  68%                  │
│                                                        │
│  Обработано: 576 / 847                                │
│  Создано: 423                                         │
│  Обновлено: 153                                       │
│  Ошибки: 0                                            │
│                                                        │
│  Текущая запись: Snickers 50г                         │
│                                                        │
│                                   [Отмена]            │
└────────────────────────────────────────────────────────┘
```

## 9.2 CSV Export

### Настройки экспорта:
- Только видимые колонки текущего View
- Кодировка: UTF-8 с BOM (для Excel)
- Разделитель: точка с запятой (;)
- Имя файла: `{directory_name}_{date}.csv`

---

# ЧАСТЬ 10: DESIGN SYSTEM "WARM BREW"

## 10.1 Цветовая палитра (oklch)

```css
:root {
  /* Primary - тёплый коричневый (кофе) */
  --primary: oklch(45% 0.12 60);
  --primary-hover: oklch(40% 0.12 60);

  /* Secondary - кремовый */
  --secondary: oklch(92% 0.03 90);

  /* Accent - карамельный */
  --accent: oklch(65% 0.15 70);

  /* Semantic */
  --success: oklch(65% 0.2 145);
  --warning: oklch(75% 0.15 85);
  --error: oklch(55% 0.2 25);

  /* Neutral */
  --background: oklch(98% 0.01 90);
  --foreground: oklch(20% 0.02 60);
  --muted: oklch(90% 0.02 90);
  --border: oklch(85% 0.02 90);
}
```

## 10.2 Типографика

```css
:root {
  --font-sans: 'Inter', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', monospace;

  /* Scale */
  --text-xs: 0.75rem;    /* 12px */
  --text-sm: 0.875rem;   /* 14px */
  --text-base: 1rem;     /* 16px */
  --text-lg: 1.125rem;   /* 18px */
  --text-xl: 1.25rem;    /* 20px */
  --text-2xl: 1.5rem;    /* 24px */
  --text-3xl: 1.875rem;  /* 30px */
}
```

## 10.3 Компоненты shadcn/ui

Используемые компоненты:
- Button, Input, Select, Checkbox, Radio
- Card, Dialog, Sheet, Popover, Tooltip
- Table, DataTable (с TanStack Table)
- Tabs, Accordion, Collapsible
- Form (react-hook-form + zod)
- Toast (sonner)
- Command (⌘K palette)

---

# ЧАСТЬ 11: ГОРЯЧИЕ КЛАВИШИ

| Клавиша | Действие |
|---------|----------|
| `⌘K` / `Ctrl+K` | Глобальный поиск |
| `⌘N` / `Ctrl+N` | Создать новую запись |
| `Escape` | Закрыть модальное окно / карточку |
| `⌘S` / `Ctrl+S` | Сохранить (в формах) |
| `⌘Enter` | Отправить форму |
| `←` / `→` | Навигация по вкладкам |
| `↑` / `↓` | Навигация по списку |
| `Enter` | Выбрать элемент |

---

# ЧАСТЬ 12: API ENDPOINTS

## 12.1 REST API структура

```
/api/v1/
├── auth/
│   ├── POST /login
│   ├── POST /logout
│   └── POST /refresh
│
├── directories/
│   ├── GET    /                    — список
│   ├── POST   /                    — создать
│   ├── GET    /:id                 — получить
│   ├── PATCH  /:id                 — обновить
│   ├── DELETE /:id                 — удалить (soft)
│   │
│   ├── GET    /:id/entries         — записи
│   ├── POST   /:id/entries         — создать запись
│   ├── GET    /:id/entries/:eid    — получить
│   ├── PATCH  /:id/entries/:eid    — обновить
│   ├── DELETE /:id/entries/:eid    — архивировать
│   │
│   ├── GET    /:id/entries/search  — поиск
│   ├── POST   /:id/entries/bulk-import
│   └── GET    /:id/entries/export
│
├── machines/
│   ├── GET    /
│   ├── GET    /:id
│   ├── GET    /:id/telemetry
│   ├── GET    /:id/brews
│   └── GET    /:id/inventory
│
├── tasks/
│   ├── GET    /
│   ├── POST   /
│   ├── GET    /:id
│   ├── PATCH  /:id
│   └── POST   /:id/complete
│
└── ...
```

---

# ГЛОССАРИЙ

| Термин | Описание |
|--------|----------|
| **Directory** | Справочник — структурированный набор записей |
| **Entry** | Запись справочника |
| **OFFICIAL** | Запись из внешнего источника (read-only) |
| **LOCAL** | Запись, созданная пользователем |
| **Inline Create** | Быстрое создание записи прямо в выпадающем списке |
| **Recent Selections** | Недавно выбранные записи для быстрого доступа |
| **Slug** | Уникальный текстовый идентификатор |
| **RBAC** | Role-Based Access Control |
| **MDM** | Master Data Management |
| **Planogram** | Схема размещения товаров в автомате |
| **Telemetry** | Данные с датчиков автомата |
| **Brew** | Процесс приготовления напитка |
| **Streak** | Серия последовательных действий |
```

---

## 🔑 КЛЮЧЕВЫЕ ОСОБЕННОСТИ ДЛЯ ВКЛЮЧЕНИЯ

При генерации документа обязательно детально опиши:

### Из Master Data Specification:
1. Directory Builder Wizard (6 шагов с wireframes)
2. 4 типа справочников (MANUAL, EXTERNAL, PARAM, TEMPLATE)
3. OFFICIAL/LOCAL разделение записей
4. Entry status workflow (DRAFT → ACTIVE → ARCHIVED)
5. 11 типов полей с валидацией
6. Inline Create механика
7. Recent Selections
8. Entry versioning

### Из UI/UX Specification:
9. Два типа товаров (напитки с рецептурой, снеки с наценкой)
10. 3-уровневый инвентарь (склад → оператор → машина)
11. AI Import с 7 агентами
12. Иерархическое заполнение БД (6 уровней)
13. Платёжные системы (Payme, Click, Uzum, TG Stars)
14. AI Провайдеры (OpenAI, Claude, Gemini, Ollama)
15. Конструктор внешних API

### Из VENDHUB_UI_DOCUMENTATION:
16. Kanban для задач (4 колонки)
17. Photo reports (Before/After)
18. Real-time карта с cluster view
19. Telegram Bot (11 команд)
20. Multi-tenant структура

### Из React Frontend Appendix:
21. Zustand stores (directories, entries, offline)
22. React hooks (useDirectory, useEntries, useSearch)
23. Optimistic updates
24. Offline режим с IndexedDB

### Из Diagrams Appendix:
25. Entry status workflow (Mermaid)
26. RBAC resolution алгоритм
27. Webhook delivery с retry
28. Search ranking (exact > prefix > fuzzy)

### Из Design System:
29. oklch цвета
30. Responsive sidebar (3 состояния)

### Из SQL Migration:
31. 13 enum types
32. 15 таблиц Master Data
33. PostgreSQL функции

### Из JSONB Examples:
34. validation_rules (8 типов)
35. directory.settings варианты
36. auth_config (5 типов)
37. entry.data примеры
38. import preview_data
39. webhook payload

### Из Checklist:
40. Frontend компоненты (20+)
41. Frontend Routes (9 маршрутов)
42. Backend модули NestJS (12)
43. Backend services (12)
44. Testing requirements

### Из NestJS Backend:
45. REST API endpoints
46. Guards & Interceptors
47. Background Jobs (BullMQ)

### Из React Frontend (дополнительно):
48. API Client структура
49. DirectorySelect states (6 состояний)
50. ImportWizard (4 шага)

### Из VendingPro Documentation:
51. Модуль Оборудование (бункеры, кофемолки, камеры, SIM)
52. 5 типов перемещений товаров
53. История варок с телеметрией
54. Модульная навигация
55. Карточка автомата (расширенные вкладки)

### Из Universal Catalog Documentation:
56. 6 типов полей каталога
57. Система Views (представлений)
58. 10 операторов фильтрации + AND/OR
59. Drag & Drop сортировка
60. CSV импорт/экспорт
61. Вложенные сущности (иерархия)
62. Inline-редактирование ячеек
63. Entry Card (боковая панель)
64. Горячие клавиши
65. Field Builder (конструктор полей)

---

## 📝 ФОРМАТ ВЫВОДА

Документ должен быть:
- В формате Markdown
- С чёткой иерархией заголовков (H1 → H2 → H3 → H4)
- С ASCII wireframes для ключевых экранов
- С таблицами для структурированных данных
- С code blocks для JSON, TypeScript, SQL примеров
- Объёмом 15,000-25,000 слов

---

## ✅ ЧЕКЛИСТ ПЕРЕД ЗАВЕРШЕНИЕМ

Убедись, что документ содержит:

- [ ] Описание всех 4 интерфейсов
- [ ] 80+ экранов Admin Dashboard
- [ ] MDM как сквозной модуль
- [ ] Directory Builder Wizard детально
- [ ] DirectorySelect со всеми состояниями
- [ ] OFFICIAL/LOCAL везде
- [ ] 2 типа товаров (напитки/снеки)
- [ ] 3-уровневый инвентарь
- [ ] 5 типов перемещений
- [ ] Оборудование (бункеры, кофемолки, камеры)
- [ ] Телеметрия варок
- [ ] AI Import (7 агентов)
- [ ] Kanban задач
- [ ] Photo reports
- [ ] Real-time карта
- [ ] Telegram Bot
- [ ] Offline режим
- [ ] 6 типов полей каталога
- [ ] 10 операторов фильтрации
- [ ] Drag & Drop
- [ ] CSV импорт/экспорт
- [ ] Вложенные сущности
- [ ] Inline-редактирование
- [ ] Горячие клавиши
- [ ] Design System
- [ ] API Endpoints
- [ ] Глоссарий

---

**НАЧНИ ГЕНЕРАЦИЮ ДОКУМЕНТА**
