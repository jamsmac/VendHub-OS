# UI Documentation: VendHub Unified Platform

## Meta
- **Дата:** 26 января 2026
- **Версия продукта:** 2.0.0
- **Автор:** AI Analysis (Claude)

---

## 1. Executive Summary

**VendHub Unified Platform** — это комплексная enterprise-система управления сетью торговых автоматов (вендинг), включающая 5 клиентских приложений и единый backend API.

### Платформы и целевая аудитория

| Приложение | Технологии | Целевая аудитория | Назначение |
|------------|-----------|-------------------|------------|
| **Web Admin** | Next.js 16, React 19 | Admin, Manager, Accountant | Dashboard управления, аналитика, настройки |
| **Client PWA** | Vite, React 19 | Покупатели | Каталог, карта автоматов, заказы, лояльность |
| **Mobile Staff** | React Native, Expo 50 | Operator, Technician | Задачи, фото-отчёты, инвентарь |
| **Telegram Bot** | Telegraf 4, Node.js | Покупатели | Поиск автоматов, баллы, заказы |
| **API Backend** | NestJS 11, TypeORM | Все системы | RESTful API, WebSocket, очереди |

### Ключевые функциональные модули

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        VENDHUB UNIFIED PLATFORM                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  📊 ОПЕРАЦИОННОЕ УПРАВЛЕНИЕ           💰 ФИНАНСЫ И АНАЛИТИКА           │
│  • Dashboard KPI                      • Транзакции и платежи            │
│  • Управление автоматами              • Интеграция Payme/Click/Uzum     │
│  • Задачи с фото-валидацией           • Отчёты и экспорт PDF/Excel     │
│  • 3-уровневый инвентарь              • Фискализация MultiKassa         │
│                                                                         │
│  👥 КЛИЕНТСКИЙ ОПЫТ                   🤖 AI И АВТОМАТИЗАЦИЯ             │
│  • Программа лояльности               • AI-агенты импорта данных        │
│  • Квесты и достижения                • Рекомендательная система        │
│  • Реферальная программа              • Предиктивная аналитика          │
│  • QR-жалобы с SLA                    • Multi-channel уведомления       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### Роли пользователей

| Роль | Уровень | Основные права |
|------|---------|----------------|
| **OWNER** | 100 | Полный доступ ко всем функциям системы |
| **ADMIN** | 90 | Управление пользователями, настройки, аудит |
| **MANAGER** | 70 | Операционное управление, отчёты |
| **ACCOUNTANT** | 50 | Финансовые отчёты, транзакции |
| **WAREHOUSE** | 40 | Управление складом, инвентарь |
| **OPERATOR** | 30 | Выполнение задач, фото-отчёты |
| **VIEWER** | 10 | Только просмотр |

---

## 2. Screens Inventory

### 2.1 Web Admin Dashboard (21 экран)

```
/auth                     → Страница входа (2FA поддержка)
/dashboard                → Главный dashboard (Overview)
/dashboard/machines       → Управление автоматами
/dashboard/products       → Каталог товаров
/dashboard/inventory      → 3-уровневый инвентарь
/dashboard/orders         → Управление заказами
/dashboard/tasks          → Задачи операторов
/dashboard/maintenance    → Техобслуживание
/dashboard/material-requests → Заявки на материалы
/dashboard/complaints     → Жалобы клиентов
/dashboard/employees      → Управление сотрудниками
/dashboard/contractors    → Подрядчики
/dashboard/work-logs      → Табель рабочего времени
/dashboard/users          → Управление пользователями
/dashboard/locations      → Локации автоматов
/dashboard/reports        → Отчёты и аналитика
/dashboard/fiscal         → Фискализация
/dashboard/integrations   → Интеграции (платежи, API)
/dashboard/settings       → Настройки системы
/dashboard/audit          → Аудит действий
/dashboard/notifications  → Центр уведомлений
```

### 2.2 Client PWA (16 экранов)

```
/                         → Главная (ближайшие автоматы)
/map                      → Карта автоматов (Google Maps)
/machine/:id              → Детали автомата
/menu/:machineId          → Меню продуктов
/cart                     → Корзина
/checkout                 → Оформление заказа
/transactions             → История покупок
/transaction/:id          → Детали транзакции
/profile                  → Профиль пользователя
/loyalty                  → Программа лояльности
/quests                   → Квесты и задания
/referrals                → Реферальная программа
/favorites                → Избранные автоматы
/complaint/:machineId     → Форма жалобы
/complaint/code/:code     → Жалоба по QR-коду
/scan                     → QR-сканер
```

### 2.3 Mobile Staff App (12 экранов)

```
SplashScreen              → Загрузка приложения
LoginScreen               → Вход в систему
RegisterScreen            → Регистрация
ForgotPasswordScreen      → Восстановление пароля
HomeScreen                → Dashboard оператора
TasksScreen               → Список задач (Active/Completed)
TaskDetailScreen          → Детали задачи
TaskPhotoScreen           → Фото до/после
MachinesScreen            → Назначенные автоматы
MachineDetailScreen       → Детали автомата
InventoryScreen           → Инвентарь
TransferScreen            → Перемещение товаров
ProfileScreen             → Профиль оператора
SettingsScreen            → Настройки
NotificationsScreen       → Уведомления
```

### 2.4 Telegram Bot (10 команд)

```
/start                    → Главное меню
/find                     → Поиск автоматов
/points                   → Бонусные баллы
/quests                   → Задания
/history                  → История покупок
/referral                 → Реферальная программа
/cart                     → Корзина
/settings                 → Настройки
/support                  → Поддержка
/help                     → Помощь
```

---

## 3. Detailed Screen Descriptions

### 3.1 Web Admin Dashboard

---

#### 3.1.1 Auth Page (Вход в систему)

**Путь:** `/auth`
**Доступ:** Публичный
**API endpoints:** `POST /api/v1/auth/login`, `POST /api/v1/auth/2fa/verify`

**Назначение:**
Аутентификация пользователей с поддержкой двухфакторной авторизации.

**Структура:**

| Элемент | Описание |
|---------|----------|
| Logo | Логотип VendHub |
| Email Input | Поле email с валидацией |
| Password Input | Пароль с toggle visibility |
| 2FA Input | Код 2FA (при включённой 2FA) |
| Login Button | Кнопка входа |
| Forgot Password | Ссылка на восстановление |

**Состояния:**

| Состояние | Описание |
|-----------|----------|
| Default | Пустая форма входа |
| Loading | Spinner во время запроса |
| 2FA Required | Показ поля ввода 2FA кода |
| Error | Сообщение об ошибке (неверный пароль, заблокирован) |
| Success | Редирект на /dashboard |

**Валидация:**
- Email: обязательное, формат email
- Password: обязательное, минимум 8 символов
- 2FA Code: 6 цифр (при наличии 2FA)

**Бизнес-логика:**
- Блокировка после 5 неудачных попыток (30 мин)
- JWT токен сохраняется в localStorage
- Refresh token для автообновления сессии

---

#### 3.1.2 Dashboard Overview

**Путь:** `/dashboard/(overview)`
**Доступ:** VIEWER+
**API endpoints:** `GET /api/v1/reports/dashboard`

**Назначение:**
Главная панель с ключевыми KPI и метриками бизнеса.

**Структура:**

```
┌─────────────────────────────────────────────────────────────────────┐
│ HEADER: Поиск | Тема | Уведомления | Профиль                        │
├──────────────┬──────────────────────────────────────────────────────┤
│              │                                                      │
│   SIDEBAR    │   KPI CARDS (4 штуки)                               │
│              │   ┌─────────┬─────────┬─────────┬─────────┐         │
│  • Обзор     │   │ Выручка │ Заказы  │ Машины  │ Задачи  │         │
│  • Автоматы  │   │ сегодня │ сегодня │ активные│ открытые│         │
│  • Товары    │   └─────────┴─────────┴─────────┴─────────┘         │
│  • Склад     │                                                      │
│  • Задачи    │   CHARTS ROW                                        │
│  • Финансы   │   ┌───────────────────┬──────────────────┐          │
│  • Клиенты   │   │ Продажи по дням   │ Топ-5 товаров    │          │
│  • Отчёты    │   │ (Line Chart)      │ (Bar Chart)      │          │
│  • Настройки │   └───────────────────┴──────────────────┘          │
│              │                                                      │
│              │   TABLES ROW                                        │
│              │   ┌───────────────────┬──────────────────┐          │
│              │   │ Последние заказы  │ Проблемные машины│          │
│              │   └───────────────────┴──────────────────┘          │
│              │                                                      │
└──────────────┴──────────────────────────────────────────────────────┘
```

**Компоненты:**

| Компонент | Тип | Данные | Действия |
|-----------|-----|--------|----------|
| KPI Cards | Card | revenue, orders, machines, tasks | Клик → переход в раздел |
| Sales Chart | Recharts LineChart | dailySales[] | Hover → tooltip |
| Top Products | Recharts BarChart | topProducts[] | Клик → детали товара |
| Recent Orders | DataTable | orders[] | Клик → детали заказа |
| Problem Machines | DataTable | machines[] | Клик → детали машины |

**Состояния:**
- Loading: Skeleton placeholders
- Empty: "Нет данных за период"
- Error: Toast с ошибкой
- Success: Полные данные с графиками

---

#### 3.1.3 Machines List

**Путь:** `/dashboard/machines`
**Доступ:** OPERATOR+
**API endpoints:** `GET /api/v1/machines`, `GET /api/v1/machines/stats`

**Назначение:**
Управление парком торговых автоматов.

**Структура:**

```
┌─────────────────────────────────────────────────────────────────────┐
│ Заголовок: Автоматы                     [+ Добавить автомат]        │
├─────────────────────────────────────────────────────────────────────┤
│ Фильтры: [Статус ▼] [Тип ▼] [Локация ▼] [Поиск...]                 │
├─────────────────────────────────────────────────────────────────────┤
│ ТАБЛИЦА АВТОМАТОВ                                                   │
│ ┌────┬──────────────┬────────┬────────────┬───────┬────────┬──────┐│
│ │ #  │ Название     │ Статус │ Локация    │ Запас │ Касса  │ ••• ││
│ ├────┼──────────────┼────────┼────────────┼───────┼────────┼──────┤│
│ │ 1  │ VM-Coffee-01 │ 🟢     │ ТЦ Навруз  │ 78%   │ 500K   │ [⋮] ││
│ │ 2  │ VM-Snack-05  │ 🟡     │ БЦ Пойтахт │ 23%   │ 120K   │ [⋮] ││
│ │ 3  │ VM-Coffee-12 │ 🔴     │ Аэропорт   │ 0%    │ 0      │ [⋮] ││
│ └────┴──────────────┴────────┴────────────┴───────┴────────┴──────┘│
├─────────────────────────────────────────────────────────────────────┤
│ Пагинация: [<] 1 2 3 ... 10 [>]     Показано: 1-20 из 156           │
└─────────────────────────────────────────────────────────────────────┘
```

**Компоненты:**

| Компонент | Тип | Данные | Действия |
|-----------|-----|--------|----------|
| Filter Status | Select | ACTIVE, INACTIVE, MAINTENANCE, ERROR | Фильтрация списка |
| Filter Type | Select | COFFEE, SNACK, COMBO, DRINK | Фильтрация |
| Filter Location | Select | locations[] | Фильтрация |
| Search | Input | query string | Поиск по названию |
| DataTable | TanStack Table | machines[] | Сортировка, клик → детали |
| Add Button | Button | - | Открыть модал создания |
| Row Actions | DropdownMenu | - | Редактировать, Удалить, Статус |

**Статусы автоматов:**
- 🟢 ACTIVE — работает нормально
- 🟡 LOW_STOCK — мало товара (<30%)
- 🟠 MAINTENANCE — на обслуживании
- 🔴 ERROR — ошибка/неисправность
- ⚫ OFFLINE — нет связи

**Состояния:**
- Loading: Skeleton таблицы
- Empty: "Нет автоматов. Добавьте первый!"
- Error: Alert с ошибкой
- Filtered Empty: "По фильтрам ничего не найдено"

---

#### 3.1.4 Tasks Management

**Путь:** `/dashboard/tasks`
**Доступ:** OPERATOR+
**API endpoints:** `GET /api/v1/tasks`, `POST /api/v1/tasks`, `PATCH /api/v1/tasks/:id`

**Назначение:**
Kanban-доска задач для операторов с фото-валидацией.

**Структура:**

```
┌─────────────────────────────────────────────────────────────────────┐
│ Задачи                            [Вид: Kanban | Список] [+Создать] │
├─────────────────────────────────────────────────────────────────────┤
│ Фильтры: [Тип ▼] [Исполнитель ▼] [Машина ▼] [Дата ▼]               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  📋 PENDING (5)     🔄 IN PROGRESS (3)    ✅ COMPLETED (12)         │
│  ┌─────────────┐    ┌─────────────┐       ┌─────────────┐          │
│  │ #T-001      │    │ #T-004      │       │ #T-010      │          │
│  │ Пополнение  │    │ Инкассация  │       │ Чистка      │          │
│  │ VM-Coffee-01│    │ VM-Snack-05 │       │ VM-Coffee-03│          │
│  │ 👤 Иван     │    │ 👤 Пётр     │       │ 👤 Алексей  │          │
│  │ ⏰ Сегодня  │    │ 📸 1/2 фото │       │ ✅ 2/2 фото │          │
│  └─────────────┘    └─────────────┘       └─────────────┘          │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**Типы задач:**
- **REFILL** — Пополнение товара
- **COLLECTION** — Инкассация наличных
- **CLEANING** — Чистка автомата
- **REPAIR** — Ремонт
- **AUDIT** — Аудит/инвентаризация

**Компоненты:**

| Компонент | Тип | Данные | Действия |
|-----------|-----|--------|----------|
| Kanban Board | DnD Grid | tasks[] by status | Drag & Drop между колонками |
| Task Card | Card | task | Клик → детали, Drag |
| Photo Badge | Badge | photos count | Индикатор фото до/после |
| Create Dialog | Dialog | CreateTaskDto | Создание задачи |
| Filter Bar | Multi-Select | filters | Фильтрация |

**Workflow задачи:**
1. PENDING → Оператор принимает задачу
2. IN_PROGRESS → Делает фото "до"
3. IN_PROGRESS → Выполняет работу
4. IN_PROGRESS → Делает фото "после"
5. COMPLETED → Задача завершена

**Бизнес-логика:**
- Фото "до" и "после" обязательны
- Задачи с SLA (время на выполнение)
- Уведомления при просрочке
- Автоназначение по локации оператора

---

#### 3.1.5 Inventory (3-уровневая система)

**Путь:** `/dashboard/inventory`
**Доступ:** WAREHOUSE+
**API endpoints:**
- `GET /api/v1/inventory/warehouse`
- `GET /api/v1/inventory/operator`
- `GET /api/v1/inventory/machine`
- `POST /api/v1/inventory/transfer`

**Назначение:**
Управление запасами на 3 уровнях: Склад → Оператор → Машина.

**Структура:**

```
┌─────────────────────────────────────────────────────────────────────┐
│ Инвентарь                           [+ Приёмка] [↔ Перемещение]     │
├─────────────────────────────────────────────────────────────────────┤
│ TABS: [🏭 Склад] [👤 Операторы] [🤖 Машины] [📜 История]            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ WAREHOUSE TAB (Склад):                                              │
│ ┌─────────────────────────────────────────────────────────────────┐ │
│ │ Зона: [Основной склад ▼]    Поиск: [____________]               │ │
│ ├─────────────────────────────────────────────────────────────────┤ │
│ │ Товар              │ SKU      │ Остаток │ Мин.  │ Статус       │ │
│ │ Кофе зерновой      │ COFFEE-01│ 45 кг   │ 10 кг │ 🟢 В норме   │ │
│ │ Snickers 50g       │ SNCK-001 │ 120 шт  │ 50 шт │ 🟢 В норме   │ │
│ │ Стаканы 200мл      │ CUP-200  │ 25 шт   │ 100 шт│ 🔴 Мало!     │ │
│ └─────────────────────────────────────────────────────────────────┘ │
│                                                                     │
│ LOW STOCK ALERTS:                                                   │
│ ⚠️ Стаканы 200мл — осталось 25 из 100 минимум                       │
│ ⚠️ Крышки — осталось 30 из 100 минимум                              │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**Уровни инвентаря:**

| Уровень | Описание | Действия |
|---------|----------|----------|
| **Warehouse** | Центральный склад | Приёмка, Выдача операторам |
| **Operator** | Инвентарь оператора | Получение со склада, Загрузка в машины |
| **Machine** | Остатки в автомате | Пополнение, Списание |

**Типы операций:**
- ADD — Приёмка товара
- REMOVE — Списание
- TRANSFER — Перемещение между уровнями
- WASTE — Списание брака
- RETURN — Возврат

**Бизнес-логика:**
- Минимальные остатки с алертами
- Автозаказ при достижении минимума
- История всех перемещений
- Сверка остатков

---

#### 3.1.6 Complaints (QR-жалобы)

**Путь:** `/dashboard/complaints`
**Доступ:** OPERATOR+
**API endpoints:**
- `GET /api/v1/complaints`
- `POST /api/v1/complaints/:id/assign`
- `POST /api/v1/complaints/:id/resolve`

**Назначение:**
Обработка жалоб клиентов с SLA-контролем.

**Структура:**

```
┌─────────────────────────────────────────────────────────────────────┐
│ Жалобы клиентов                              [Экспорт] [Статистика] │
├─────────────────────────────────────────────────────────────────────┤
│ Фильтры: [Статус ▼] [Тип ▼] [SLA ▼] [Дата ▼]                       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  📋 OPEN (8)        🔄 IN PROGRESS (5)    ✅ RESOLVED (45)          │
│  ┌─────────────┐    ┌─────────────┐       ┌─────────────┐          │
│  │ #C-156      │    │ #C-148      │       │ #C-142      │          │
│  │ 🔧 Автомат  │    │ 💳 Оплата   │       │ 📦 Товар    │          │
│  │ VM-Coffee-01│    │ VM-Snack-05 │       │ VM-Coffee-03│          │
│  │ ⏰ 2ч 15мин │    │ 👤 Иван     │       │ ⭐ 5/5      │          │
│  │ 🔴 SLA!     │    │ 🟡 4ч осталось│      │ ✅ Решена   │          │
│  └─────────────┘    └─────────────┘       └─────────────┘          │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**Типы жалоб:**
- 🔧 MACHINE — Проблема с автоматом
- 📦 PRODUCT — Проблема с товаром
- 💳 PAYMENT — Проблема с оплатой
- ❓ OTHER — Другое

**SLA (Service Level Agreement):**
- Критичные (оплата не прошла) — 2 часа
- Высокий приоритет — 4 часа
- Средний приоритет — 8 часов
- Низкий приоритет — 24 часа

**Workflow:**
1. OPEN → Клиент создал жалобу (QR-код или приложение)
2. ASSIGNED → Назначен ответственный
3. IN_PROGRESS → Работа над решением
4. RESOLVED → Решена, ждём отзыв
5. CLOSED → Клиент подтвердил / таймаут

**Действия:**
- Назначить ответственного
- Эскалировать
- Создать задачу
- Оформить возврат
- Закрыть с комментарием

---

### 3.2 Client PWA

---

#### 3.2.1 Home Page

**Путь:** `/`
**Доступ:** Публичный (с авторизацией для персонализации)
**API endpoints:** `GET /api/v1/machines/nearby`

**Назначение:**
Главная страница с поиском и ближайшими автоматами.

**Структура:**

```
┌─────────────────────────────────────────────────────────────────────┐
│ [Logo] VendHub                              [🌐 RU] [≡ Меню]        │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ╔═══════════════════════════════════════════════════════════════╗ │
│  ║  🔍 Найти автомат рядом с вами...                             ║ │
│  ╚═══════════════════════════════════════════════════════════════╝ │
│                                                                     │
│  📊 СТАТИСТИКА                                                      │
│  ┌─────────────┬─────────────┬─────────────┐                       │
│  │ 🤖 156      │ ⏰ 24/7     │ ☕ 50+      │                       │
│  │ автоматов   │ работаем    │ напитков    │                       │
│  └─────────────┴─────────────┴─────────────┘                       │
│                                                                     │
│  📍 БЛИЖАЙШИЕ АВТОМАТЫ                                              │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ [☕] VM-Coffee-01                                   🟢      │   │
│  │     ТЦ Навруз, 1 этаж                              450м →   │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │ [🍫] VM-Snack-05                                   🟢      │   │
│  │     БЦ Пойтахт, холл                               1.2км →  │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  [🗺 Показать все на карте]                                         │
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│ [🏠] [🗺] [📷 Scan] [📜] [👤]  ← Bottom Navigation                  │
└─────────────────────────────────────────────────────────────────────┘
```

**Компоненты:**

| Компонент | Тип | Данные | Действия |
|-----------|-----|--------|----------|
| SearchBar | Input | query | Поиск по названию/адресу |
| StatsCards | Card[] | stats | - |
| MachineCard | Card | machine | Клик → /machine/:id |
| BottomNav | Navigation | - | Переход между разделами |

**Состояния:**
- Loading: Skeleton cards
- No Location: Запрос геолокации
- Empty: "Автоматов поблизости нет"
- Success: Список ближайших 6 автоматов

**Геолокация:**
- Автоматический запрос при первом входе
- Расчёт расстояния по формуле Хаверсина
- Сортировка по удалённости

---

#### 3.2.2 Map Page

**Путь:** `/map`
**Доступ:** Публичный
**API endpoints:** `GET /api/v1/machines`, `GET /api/v1/locations/nearby`

**Назначение:**
Интерактивная карта всех автоматов.

**Структура:**

```
┌─────────────────────────────────────────────────────────────────────┐
│ [←] Карта автоматов              [🗺 Карта | 📋 Список]            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ╔═══════════════════════════════════════════════════════════════╗ │
│  ║                     GOOGLE MAPS                               ║ │
│  ║                                                               ║ │
│  ║           [☕]                                                ║ │
│  ║                    [🍫]                [☕]                   ║ │
│  ║                                                               ║ │
│  ║      [📍 Вы]              [🥤]                               ║ │
│  ║                                                               ║ │
│  ║                                  [☕]                         ║ │
│  ╚═══════════════════════════════════════════════════════════════╝ │
│                                                        [◎] Center  │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ [☕] VM-Coffee-01                         [Меню] [Маршрут]   │   │
│  │     ТЦ Навруз • 450м • 🟢 Работает                          │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│ [🏠] [🗺] [📷 Scan] [📜] [👤]                                       │
└─────────────────────────────────────────────────────────────────────┘
```

**Маркеры:**
- ☕ — Кофейный автомат
- 🍫 — Снековый автомат
- 🥤 — Напитки
- 🎯 — Комбо (всё)

**Компоненты:**

| Компонент | Тип | Данные | Действия |
|-----------|-----|--------|----------|
| GoogleMap | Map | machines[], userLocation | Pan, Zoom, Marker click |
| ViewToggle | Tabs | 'map' | 'list' | Переключение вида |
| MachinePopup | Card | selectedMachine | Показ при клике на маркер |
| CenterButton | FAB | - | Центрировать на пользователе |
| ListView | List | machines[] | Список автоматов |

**Интеракции:**
- Клик на маркер → показ карточки внизу
- "Меню" → переход к /menu/:id
- "Маршрут" → открытие Yandex.Maps/Google Maps

---

#### 3.2.3 Cart Page

**Путь:** `/cart`
**Доступ:** Авторизованный
**API endpoints:** Локальный store (Zustand)

**Назначение:**
Просмотр и редактирование корзины перед оплатой.

**Структура:**

```
┌─────────────────────────────────────────────────────────────────────┐
│ [←] Корзина                                          [🗑 Очистить] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  📍 Автомат: VM-Coffee-01 (ТЦ Навруз)                               │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ [IMG] Американо                                              │   │
│  │       20,000 UZS                      [-] 2 [+]   40,000    │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │ [IMG] Snickers 50g                                          │   │
│  │       12,000 UZS                      [-] 1 [+]   12,000    │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 🏷 Промокод: [COFFEE10______] [Применить]                   │   │
│  │              ✅ Скидка 10% применена                        │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ───────────────────────────────────────────────────────────────   │
│  Подитог:                                            52,000 UZS    │
│  Скидка (10%):                                       -5,200 UZS    │
│  ───────────────────────────────────────────────────────────────   │
│  ИТОГО:                                              46,800 UZS    │
│                                                                     │
│  ╔═══════════════════════════════════════════════════════════════╗ │
│  ║           [💳 Оплатить 46,800 UZS]                            ║ │
│  ╚═══════════════════════════════════════════════════════════════╝ │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**Компоненты:**

| Компонент | Тип | Данные | Действия |
|-----------|-----|--------|----------|
| MachineInfo | Card | machine | - |
| CartItem | Card | item | +/- количество, удалить |
| PromoInput | Input + Button | promoCode | Применить промокод |
| Summary | Card | subtotal, discount, total | - |
| CheckoutButton | Button | total | Переход к оплате |

**Промокоды:**
- COFFEE10 — 10% скидка
- FIRST — 15% на первый заказ
- LOYALTY — использование баллов

**Валидация:**
- Минимум 1, максимум 10 единиц товара
- Проверка наличия на складе
- Валидность промокода

---

#### 3.2.4 Profile Page

**Путь:** `/profile`
**Доступ:** Авторизованный
**API endpoints:** `GET /api/v1/auth/me`

**Назначение:**
Профиль пользователя, настройки, статистика.

**Структура:**

```
┌─────────────────────────────────────────────────────────────────────┐
│ Профиль                                                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │         [AVATAR]                                            │   │
│  │         Иван Иванов                                         │   │
│  │         📱 +998 90 123 45 67                                │   │
│  │         💎 Gold • 2,450 баллов                              │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  📊 СТАТИСТИКА                                                      │
│  ┌─────────────┬─────────────┬─────────────┐                       │
│  │ 🛒 45       │ ⭐ 3        │ 💰 450K     │                       │
│  │ покупок     │ избранных   │ UZS потрачено│                      │
│  └─────────────┴─────────────┴─────────────┘                       │
│                                                                     │
│  ⚙️ НАСТРОЙКИ                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 👤 Редактировать профиль                              [→]   │   │
│  │ 💎 Программа лояльности                               [→]   │   │
│  │ 🎯 Мои задания                                        [→]   │   │
│  │ 👥 Пригласить друга                                   [→]   │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │ 🌐 Язык: Русский                                      [→]   │   │
│  │ 🌙 Тема: Светлая                                      [→]   │   │
│  │ 🔔 Уведомления                                        [🔘]  │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │ 💬 Telegram бот                                       [→]   │   │
│  │ 📞 Горячая линия                                      [→]   │   │
│  │ ❓ FAQ                                                [→]   │   │
│  │ 📜 Условия использования                              [→]   │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  [🚪 Выйти из аккаунта]                                             │
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│ [🏠] [🗺] [📷 Scan] [📜] [👤]                                       │
└─────────────────────────────────────────────────────────────────────┘
```

**Компоненты:**

| Компонент | Тип | Данные | Действия |
|-----------|-----|--------|----------|
| UserCard | Card | user, loyalty | - |
| StatsCards | Card[] | stats | Клик → раздел |
| MenuGroup | List | menuItems | Клик → переход |
| LanguageSelect | Select | 'ru'|'uz'|'en' | Смена языка |
| ThemeSelect | Select | 'light'|'dark'|'system' | Смена темы |
| LogoutButton | Button | - | Выход из аккаунта |

**Языки:**
- 🇷🇺 Русский (ru)
- 🇺🇿 O'zbekcha (uz)
- 🇬🇧 English (en)

---

### 3.3 Mobile Staff App

---

#### 3.3.1 Home Screen (Dashboard оператора)

**Путь:** `HomeScreen`
**Доступ:** OPERATOR+
**API endpoints:** `GET /api/v1/reports/dashboard`, `GET /api/v1/tasks/my`

**Назначение:**
Главный экран оператора с KPI и быстрыми действиями.

**Структура:**

```
┌─────────────────────────────────────────────────────────────────────┐
│ 👋 Привет, Иван!                                        [🔔 3]     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  📊 СЕГОДНЯ                                                         │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐         │
│  │ ✅ 5        │ 🤖 8        │ ✔️ 3        │ ⚠️ 1        │         │
│  │ активных    │ машин       │ выполнено   │ просрочено  │         │
│  └─────────────┴─────────────┴─────────────┴─────────────┘         │
│                                                                     │
│  ⚡ БЫСТРЫЕ ДЕЙСТВИЯ                                                │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐         │
│  │ [📋]        │ [📷]        │ [🔔]        │ [📦]        │         │
│  │ Мои задачи  │ QR Скан     │ Уведомления │ Склад       │         │
│  └─────────────┴─────────────┴─────────────┴─────────────┘         │
│                                                                     │
│  📋 БЛИЖАЙШИЕ ЗАДАЧИ                                                │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 🔄 Пополнение • VM-Coffee-01                                │   │
│  │    ТЦ Навруз • ⏰ через 2 часа • 🟡 Высокий                │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │ 💵 Инкассация • VM-Snack-05                                 │   │
│  │    БЦ Пойтахт • ⏰ через 4 часа • 🟢 Средний               │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │ 🧹 Чистка • VM-Coffee-12                                    │   │
│  │    Аэропорт • ⏰ завтра • 🟢 Низкий                        │   │
│  └─────────────────────────────────────────────────────────────┘   │
│  [Все задачи →]                                                    │
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│ [🏠] [📋] [🤖] [👤]  ← Bottom Tab Navigation                       │
└─────────────────────────────────────────────────────────────────────┘
```

**Компоненты:**

| Компонент | Тип | Данные | Действия |
|-----------|-----|--------|----------|
| Greeting | Text | user.firstName | - |
| NotificationBadge | Badge | unreadCount | Переход к уведомлениям |
| StatCards | Card[] | stats | - |
| QuickActions | Grid | actions | Переход к разделу |
| TaskList | FlatList | tasks.slice(0,3) | Клик → TaskDetail |

**Pull-to-Refresh:** Да

---

#### 3.3.2 Task Detail Screen

**Путь:** `TaskDetailScreen`
**Доступ:** OPERATOR+
**API endpoints:**
- `GET /api/v1/tasks/:id`
- `POST /api/v1/tasks/:id/start`
- `POST /api/v1/tasks/:id/photo-before`
- `POST /api/v1/tasks/:id/photo-after`
- `POST /api/v1/tasks/:id/complete`

**Назначение:**
Детали задачи с управлением выполнением и фото-валидацией.

**Структура:**

```
┌─────────────────────────────────────────────────────────────────────┐
│ [←] Задача #T-001                                     [🔄 Пополнение]│
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  📍 АВТОМАТ                                                         │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ VM-Coffee-01                                                │   │
│  │ ТЦ Навруз, 1 этаж                      [🗺 Маршрут]         │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  📋 ДЕТАЛИ                                                          │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ Срок: Сегодня, 18:00                              🟡 4ч     │   │
│  │ Приоритет: Высокий                                          │   │
│  │ Описание: Пополнить кофе и стаканы                          │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  📦 ТОВАРЫ ДЛЯ ЗАГРУЗКИ                                             │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ ☐ Кофе зерновой                         5 кг → [___] кг    │   │
│  │ ☐ Стаканы 200мл                        100 шт → [___] шт   │   │
│  │ ☐ Крышки                                50 шт → [___] шт   │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  📸 ФОТО                                                            │
│  ┌─────────────┬─────────────┐                                     │
│  │ [📷 ДО]     │ [📷 ПОСЛЕ]  │                                     │
│  │ ❌ Нет фото │ ❌ Нет фото │                                     │
│  └─────────────┴─────────────┘                                     │
│                                                                     │
│  ╔═══════════════════════════════════════════════════════════════╗ │
│  ║              [▶️ Начать выполнение]                            ║ │
│  ╚═══════════════════════════════════════════════════════════════╝ │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**Компоненты:**

| Компонент | Тип | Данные | Действия |
|-----------|-----|--------|----------|
| TaskHeader | View | task.type, task.number | - |
| MachineCard | Card | machine | "Маршрут" → Yandex Maps |
| TaskDetails | Card | task.dueDate, priority, description | - |
| ItemsList | FlatList | task.items | Ввод фактического количества |
| PhotoSection | View | photoBefore, photoAfter | Клик → камера |
| ActionButton | Button | - | Начать / Завершить |

**Workflow:**
1. `PENDING` → кнопка "Начать"
2. `IN_PROGRESS` → кнопка "Фото ДО"
3. После фото → заполнение товаров
4. → кнопка "Фото ПОСЛЕ"
5. → кнопка "Завершить"

**Валидация:**
- Фото ДО обязательно
- Фото ПОСЛЕ обязательно
- Для инкассации — ввод суммы

---

### 3.4 Telegram Bot

---

#### 3.4.1 Start Command (Главное меню)

**Команда:** `/start`
**API endpoints:** `POST /api/v1/users` (регистрация), `GET /api/v1/users/telegram/:id`

**Назначение:**
Приветствие и главное меню бота.

**Сообщение:**

```
👋 Привет, Иван!

Добро пожаловать в VendHub — сеть умных торговых автоматов.

С моей помощью вы можете:
• 📍 Найти ближайшие автоматы
• 💎 Копить бонусные баллы
• 🎯 Выполнять задания за награды
• 🛒 Делать заказы
• 📜 Смотреть историю покупок

Выберите действие:

[🗺 Найти автомат] [💎 Мои баллы]
[🎯 Задания] [📜 История]
[⚙️ Настройки] [❓ Помощь]
```

**Inline Keyboard:**

| Кнопка | Callback | Действие |
|--------|----------|----------|
| 🗺 Найти автомат | find_machines | Запрос геолокации |
| 💎 Мои баллы | my_points | Показ баланса |
| 🎯 Задания | my_quests | Список квестов |
| 📜 История | my_history | Последние покупки |
| ⚙️ Настройки | settings | Меню настроек |
| ❓ Помощь | help | Справка |

**Реферальная ссылка:**
- Формат: `https://t.me/VendHubBot?start=ref_USERCODE`
- При переходе — автоматическое применение реферала

---

#### 3.4.2 Find Command (Поиск автоматов)

**Команда:** `/find`
**API endpoints:** `GET /api/v1/machines/nearby`

**Workflow:**

```
1. Бот запрашивает геолокацию:

   📍 Отправьте мне вашу геолокацию, чтобы найти ближайшие автоматы:

   [📍 Отправить геолокацию]
   [❌ Отмена]

2. Пользователь отправляет location

3. Бот показывает результаты:

   📍 Найдено 5 автоматов рядом с вами:

   1. ☕ VM-Coffee-01
      📍 ТЦ Навруз, 1 этаж
      📏 450м • 🟢 Работает
      [📋 Меню] [🗺 Маршрут]

   2. 🍫 VM-Snack-05
      📍 БЦ Пойтахт, холл
      📏 1.2км • 🟢 Работает
      [📋 Меню] [🗺 Маршрут]

   [🔄 Обновить] [🔙 Меню]
```

---

#### 3.4.3 Points Command (Баллы лояльности)

**Команда:** `/points`
**API endpoints:** `GET /api/v1/loyalty/me`

**Сообщение:**

```
💎 *Ваш баланс лояльности*

Уровень: 🥇 Gold
Баллы: 2,450 💎

━━━━━━━━━━━━━━━━━━━━━
📊 Прогресс до Platinum:
[████████░░] 80%
Осталось: 550 баллов
━━━━━━━━━━━━━━━━━━━━━

🎁 *Ваши привилегии:*
• +15% баллов за покупки
• Бесплатный напиток каждые 10 покупок
• Приоритетная поддержка

[💳 История баллов] [🎁 Потратить]
[🔙 Меню]
```

---

## 4. User Flows

### 4.1 Flow: Оформление заказа (Client PWA)

**Актор:** Покупатель
**Цель:** Купить товар в автомате

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  [Главная] ──→ [Карта] ──→ [Выбор автомата] ──→ [Меню]             │
│       │                          │                  │               │
│       └──────────────────────────┘                  │               │
│                                                     ↓               │
│                                              [Добавить в корзину]   │
│                                                     │               │
│                                                     ↓               │
│                                              [Корзина]              │
│                                                     │               │
│                                   ┌─────────────────┼───────────┐   │
│                                   │                 │           │   │
│                                   ↓                 ↓           ↓   │
│                            [Промокод]        [Изменить]   [Удалить] │
│                                   │                 │               │
│                                   └─────────────────┘               │
│                                             │                       │
│                                             ↓                       │
│                                      [Оформить заказ]               │
│                                             │                       │
│                               ┌─────────────┼─────────────┐         │
│                               │             │             │         │
│                               ↓             ↓             ↓         │
│                          [Payme]       [Click]       [Uzum]         │
│                               │             │             │         │
│                               └─────────────┼─────────────┘         │
│                                             │                       │
│                                             ↓                       │
│                                    [Подтверждение оплаты]           │
│                                             │                       │
│                                             ↓                       │
│                                      [Получить товар]               │
│                                             │                       │
│                                             ↓                       │
│                                    [Оставить отзыв] (опционально)   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**Шаги:**

| # | Действие | Результат | Следующий экран |
|---|----------|-----------|-----------------|
| 1 | Открывает приложение | Запрос геолокации | Главная |
| 2 | Нажимает "Карта" | Загрузка маркеров | Map Page |
| 3 | Выбирает автомат | Показ карточки | Machine Detail |
| 4 | Нажимает "Меню" | Загрузка товаров | Menu Page |
| 5 | Выбирает товар | Добавление в корзину | Menu Page |
| 6 | Нажимает корзину | Показ содержимого | Cart Page |
| 7 | Вводит промокод | Применение скидки | Cart Page |
| 8 | Нажимает "Оплатить" | Выбор способа оплаты | Checkout |
| 9 | Выбирает Payme | Редирект на оплату | Payme Page |
| 10 | Оплачивает | Возврат в приложение | Success Page |
| 11 | Забирает товар | Закрытие заказа | Home Page |

**Альтернативные пути:**
- Если промокод неверный → показ ошибки
- Если товара нет в наличии → предложение замены
- Если оплата не прошла → возврат к корзине

---

### 4.2 Flow: Выполнение задачи (Mobile Staff)

**Актор:** Оператор
**Цель:** Выполнить задачу пополнения автомата

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  [Login] ──→ [Home] ──→ [Tasks] ──→ [Task Detail]                  │
│                                           │                         │
│                                           ↓                         │
│                                    [Начать задачу]                  │
│                                           │                         │
│                                           ↓                         │
│                                    [Сделать фото ДО]                │
│                                           │                         │
│                                           ↓                         │
│                                    [Камера]                         │
│                                           │                         │
│                                           ↓                         │
│                                    [Загрузить товары]               │
│                                           │                         │
│                                           ↓                         │
│                                    [Ввести количества]              │
│                                           │                         │
│                                           ↓                         │
│                                    [Сделать фото ПОСЛЕ]             │
│                                           │                         │
│                                           ↓                         │
│                                    [Камера]                         │
│                                           │                         │
│                                           ↓                         │
│                                    [Завершить задачу]               │
│                                           │                         │
│                                           ↓                         │
│                                    [Success → Home]                 │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**Шаги:**

| # | Действие | Результат | API |
|---|----------|-----------|-----|
| 1 | Выбирает задачу | Загрузка деталей | GET /tasks/:id |
| 2 | Нажимает "Начать" | Статус = IN_PROGRESS | POST /tasks/:id/start |
| 3 | Нажимает "Фото ДО" | Открытие камеры | - |
| 4 | Делает фото | Загрузка фото | POST /tasks/:id/photo-before |
| 5 | Выполняет работу | - | - |
| 6 | Вводит количества | Сохранение | PATCH /tasks/:id |
| 7 | Нажимает "Фото ПОСЛЕ" | Открытие камеры | - |
| 8 | Делает фото | Загрузка фото | POST /tasks/:id/photo-after |
| 9 | Нажимает "Завершить" | Статус = COMPLETED | POST /tasks/:id/complete |

**Валидация:**
- Фото ДО обязательно перед работой
- Фото ПОСЛЕ обязательно для завершения
- Для инкассации — ввод суммы денег

---

### 4.3 Flow: Подача жалобы через QR (Client PWA)

**Актор:** Покупатель
**Цель:** Пожаловаться на проблему с автоматом

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  [QR на автомате] ──→ [Сканирование] ──→ [Форма жалобы]            │
│                                                │                    │
│                                                ↓                    │
│                                         [Выбор типа проблемы]       │
│                                                │                    │
│                                                ↓                    │
│                                         [Описание проблемы]         │
│                                                │                    │
│                                                ↓                    │
│                                         [Фото (опционально)]        │
│                                                │                    │
│                                                ↓                    │
│                                         [Контактные данные]         │
│                                                │                    │
│                                                ↓                    │
│                                         [Отправить]                 │
│                                                │                    │
│                                                ↓                    │
│                                         [Номер жалобы #C-XXX]       │
│                                                │                    │
│                                                ↓                    │
│                                         [Отслеживание статуса]      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**Типы проблем:**
- 🔧 Автомат не работает
- 📦 Товар не выдан
- 💳 Деньги списались, но товар не выдан
- ❓ Другое

---

## 5. API Integration Map

### 5.1 Маппинг экранов на endpoints

| Экран | Метод | Endpoint | Описание |
|-------|-------|----------|----------|
| **Auth** | POST | /api/v1/auth/login | Вход в систему |
| | POST | /api/v1/auth/2fa/verify | Проверка 2FA |
| | POST | /api/v1/auth/refresh | Обновление токена |
| **Dashboard** | GET | /api/v1/reports/dashboard | KPI и метрики |
| **Machines** | GET | /api/v1/machines | Список автоматов |
| | GET | /api/v1/machines/:id | Детали автомата |
| | POST | /api/v1/machines | Создание |
| | PATCH | /api/v1/machines/:id | Обновление |
| **Products** | GET | /api/v1/products | Каталог товаров |
| | GET | /api/v1/products/:id | Детали товара |
| **Inventory** | GET | /api/v1/inventory/warehouse | Склад |
| | GET | /api/v1/inventory/operator | Инвентарь оператора |
| | GET | /api/v1/inventory/machine | Инвентарь машины |
| | POST | /api/v1/inventory/transfer | Перемещение |
| **Tasks** | GET | /api/v1/tasks | Все задачи |
| | GET | /api/v1/tasks/my | Мои задачи |
| | POST | /api/v1/tasks/:id/start | Начать задачу |
| | POST | /api/v1/tasks/:id/photo-before | Фото до |
| | POST | /api/v1/tasks/:id/photo-after | Фото после |
| | POST | /api/v1/tasks/:id/complete | Завершить |
| **Complaints** | GET | /api/v1/complaints | Список жалоб |
| | POST | /api/v1/complaints/public | Публичная жалоба |
| | POST | /api/v1/complaints/:id/resolve | Разрешить |
| **Loyalty** | GET | /api/v1/loyalty/me | Мой профиль лояльности |
| | GET | /api/v1/quests/my | Мои квесты |
| | GET | /api/v1/referrals/me | Мой реферальный статус |
| **Payments** | POST | /api/v1/payments/payme/create | Создать платёж Payme |
| | POST | /api/v1/payments/click/create | Создать платёж Click |

### 5.2 Обработка ответов API

**Успешный ответ (200/201):**
```json
{
  "success": true,
  "data": { ... },
  "meta": {
    "total": 100,
    "page": 1,
    "limit": 20
  }
}
```

**Ошибка валидации (400):**
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Ошибка валидации",
    "details": [
      { "field": "email", "message": "Неверный формат email" }
    ]
  }
}
```

**Ошибка авторизации (401):**
```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Требуется авторизация"
  }
}
```

**Ошибка доступа (403):**
```json
{
  "success": false,
  "error": {
    "code": "FORBIDDEN",
    "message": "Доступ запрещён"
  }
}
```

---

## 6. Access Control Matrix

### 6.1 Матрица доступа по ролям

| Функция | OWNER | ADMIN | MANAGER | ACCOUNTANT | WAREHOUSE | OPERATOR | VIEWER |
|---------|:-----:|:-----:|:-------:|:----------:|:---------:|:--------:|:------:|
| **Dashboard** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **Machines - View** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **Machines - Create** | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **Machines - Edit** | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **Machines - Delete** | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **Products - View** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **Products - Create** | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **Products - Edit** | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **Inventory - View** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **Inventory - Transfer** | ✅ | ✅ | ✅ | ❌ | ✅ | ✅ | ❌ |
| **Tasks - View** | ✅ | ✅ | ✅ | ❌ | ❌ | ✅ | ❌ |
| **Tasks - Create** | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **Tasks - Execute** | ✅ | ✅ | ✅ | ❌ | ❌ | ✅ | ❌ |
| **Complaints - View** | ✅ | ✅ | ✅ | ❌ | ❌ | ✅ | ❌ |
| **Complaints - Resolve** | ✅ | ✅ | ✅ | ❌ | ❌ | ✅ | ❌ |
| **Reports - View** | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ✅ |
| **Reports - Export** | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ |
| **Users - View** | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **Users - Create** | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **Users - Delete** | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **Settings - System** | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **Audit - View** | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **Fiscal - Manage** | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ |

### 6.2 Условная видимость элементов

**Sidebar меню:**
- "Пользователи" — только ADMIN+
- "Аудит" — только ADMIN+
- "Настройки системы" — только ADMIN+
- "Фискализация" — только ACCOUNTANT+

**Кнопки действий:**
- "Удалить" — только ADMIN+
- "Экспорт" — только ACCOUNTANT+
- "Создать пользователя" — только ADMIN+

---

## 7. Responsive Design

### 7.1 Breakpoints

| Название | Размер | Устройства |
|----------|--------|------------|
| `sm` | ≥ 640px | Маленькие телефоны |
| `md` | ≥ 768px | Планшеты |
| `lg` | ≥ 1024px | Ноутбуки |
| `xl` | ≥ 1280px | Десктопы |
| `2xl` | ≥ 1536px | Большие мониторы |

### 7.2 Поведение Sidebar

| Размер экрана | Sidebar |
|---------------|---------|
| < 768px | Скрыт, открывается по кнопке (Sheet/Drawer) |
| 768px - 1024px | Collapsed (только иконки, 60px) |
| > 1024px | Expanded (полный, 280px) |

### 7.3 Таблицы на мобильных

- Горизонтальный скролл
- Приоритетные колонки слева
- Сворачивание в карточки на xs

---

## 8. Localization

### 8.1 Поддерживаемые языки

| Код | Язык | Направление |
|-----|------|-------------|
| `ru` | Русский | LTR |
| `uz` | O'zbekcha | LTR |
| `en` | English | LTR |

### 8.2 Форматы

| Тип | Формат (ru) | Пример |
|-----|-------------|--------|
| Дата | DD.MM.YYYY | 26.01.2026 |
| Время | HH:mm | 14:30 |
| Валюта | # ### UZS | 50 000 UZS |
| Числа | # ### ### | 1 234 567 |
| Телефон | +998 XX XXX XX XX | +998 90 123 45 67 |

---

## 9. UI Components Library

### 9.1 Используемые библиотеки

| Приложение | UI Framework | Компоненты |
|------------|--------------|------------|
| Web Admin | shadcn/ui + Radix UI | Button, Card, Dialog, Table, Tabs, etc. |
| Client PWA | shadcn/ui + Radix UI | Button, Card, Input, Select, etc. |
| Mobile | React Native Paper | Button, Card, Input, List, etc. |

### 9.2 Основные компоненты

**Button variants:**
- `default` — основная кнопка (Primary)
- `secondary` — второстепенная
- `outline` — контурная
- `ghost` — прозрачная
- `destructive` — удаление (красная)

**Badge variants:**
- `default` — нейтральный
- `success` — зелёный (активен, выполнено)
- `warning` — жёлтый (внимание)
- `destructive` — красный (ошибка)

**Card структура:**
```tsx
<Card>
  <CardHeader>
    <CardTitle>Заголовок</CardTitle>
    <CardDescription>Описание</CardDescription>
  </CardHeader>
  <CardContent>
    {/* Содержимое */}
  </CardContent>
  <CardFooter>
    {/* Действия */}
  </CardFooter>
</Card>
```

---

## 10. Design System "Warm Brew"

### 10.1 Цветовая палитра

**Light Theme:**

| Назначение | Цвет | HEX |
|------------|------|-----|
| Primary (Espresso) | Тёмно-коричневый | #5D4037 |
| Accent (Caramel) | Карамельный | #D4A574 |
| Success (Mint) | Мятный | #7CB69D |
| Background (Cream) | Кремовый | #FDF8F3 |
| Text Primary | Шоколадный | #2C1810 |
| Error | Красный | #EF4444 |
| Warning | Оранжевый | #F59E0B |
| Info | Синий | #3B82F6 |

**Dark Theme:**

| Назначение | Цвет | HEX |
|------------|------|-----|
| Background | Тёмно-серый | #121212 |
| Card | Серый | #1E1E1E |
| Text | Белый | #F5F5F5 |

### 10.2 Типографика

| Элемент | Шрифт | Размер |
|---------|-------|--------|
| Display | Playfair Display | 36px |
| Heading 1 | DM Sans Bold | 30px |
| Heading 2 | DM Sans Bold | 24px |
| Heading 3 | DM Sans SemiBold | 20px |
| Body | DM Sans | 16px |
| Small | DM Sans | 14px |
| Caption | DM Sans | 12px |
| Mono (код) | JetBrains Mono | 14px |

### 10.3 Иконки

- **Библиотека:** Lucide React (600+ иконок)
- **Размеры:** 16px (small), 20px (default), 24px (large)
- **Stroke width:** 2px

---

## Appendix

### A. Глоссарий терминов

| Термин | Описание |
|--------|----------|
| **Machine** | Торговый автомат (вендинговый аппарат) |
| **Task** | Сервисная задача для оператора |
| **Refill** | Пополнение товара в автомате |
| **Collection** | Инкассация (сбор наличных) |
| **SLA** | Service Level Agreement (время на решение) |
| **Loyalty** | Программа лояльности (баллы) |
| **Quest** | Задание для пользователя (геймификация) |
| **Referral** | Реферальная программа |

### B. Список экранов (полный)

**Web Admin (21):**
1. /auth
2. /dashboard/(overview)
3. /dashboard/machines
4. /dashboard/products
5. /dashboard/inventory
6. /dashboard/orders
7. /dashboard/tasks
8. /dashboard/maintenance
9. /dashboard/material-requests
10. /dashboard/complaints
11. /dashboard/employees
12. /dashboard/contractors
13. /dashboard/work-logs
14. /dashboard/users
15. /dashboard/locations
16. /dashboard/reports
17. /dashboard/fiscal
18. /dashboard/integrations
19. /dashboard/settings
20. /dashboard/audit
21. /dashboard/notifications

**Client PWA (16):**
1. / (Home)
2. /map
3. /machine/:id
4. /menu/:machineId
5. /cart
6. /checkout
7. /transactions
8. /transaction/:id
9. /profile
10. /loyalty
11. /quests
12. /referrals
13. /favorites
14. /complaint/:machineId
15. /complaint/code/:code
16. /scan

**Mobile Staff (12):**
1. SplashScreen
2. LoginScreen
3. RegisterScreen
4. ForgotPasswordScreen
5. HomeScreen
6. TasksScreen
7. TaskDetailScreen
8. TaskPhotoScreen
9. MachinesScreen
10. MachineDetailScreen
11. InventoryScreen
12. TransferScreen
13. ProfileScreen
14. SettingsScreen
15. NotificationsScreen

### C. Список API Endpoints (полный)

```
# ════════════════════════════════════════════════════════════════════
# AUTH (12 endpoints)
# ════════════════════════════════════════════════════════════════════
POST   /api/v1/auth/register              # Регистрация
POST   /api/v1/auth/login                 # Вход (с опциональным 2FA)
POST   /api/v1/auth/refresh               # Обновление токена
POST   /api/v1/auth/logout                # Выход
GET    /api/v1/auth/me                    # Текущий пользователь
GET    /api/v1/auth/sessions              # Активные сессии
POST   /api/v1/auth/password/forgot       # Забыли пароль
POST   /api/v1/auth/password/reset        # Сброс пароля
POST   /api/v1/auth/2fa/enable            # Включить 2FA
POST   /api/v1/auth/2fa/verify            # Проверить код 2FA
POST   /api/v1/auth/2fa/disable           # Отключить 2FA
POST   /api/v1/auth/2fa/backup-codes      # Генерация backup кодов

# ════════════════════════════════════════════════════════════════════
# MACHINES (8 endpoints)
# ════════════════════════════════════════════════════════════════════
GET    /api/v1/machines                   # Список автоматов
GET    /api/v1/machines/stats             # Статистика автоматов
GET    /api/v1/machines/:id               # Детали автомата
POST   /api/v1/machines                   # Создание автомата
PATCH  /api/v1/machines/:id               # Обновление автомата
PATCH  /api/v1/machines/:id/status        # Изменение статуса
PATCH  /api/v1/machines/:id/telemetry     # Обновление телеметрии
DELETE /api/v1/machines/:id               # Удаление (soft delete)

# ════════════════════════════════════════════════════════════════════
# PRODUCTS (5 endpoints)
# ════════════════════════════════════════════════════════════════════
GET    /api/v1/products                   # Каталог товаров
GET    /api/v1/products/:id               # Детали товара
POST   /api/v1/products                   # Создание товара
PATCH  /api/v1/products/:id               # Обновление товара
DELETE /api/v1/products/:id               # Удаление товара

# ════════════════════════════════════════════════════════════════════
# INVENTORY (6 endpoints)
# ════════════════════════════════════════════════════════════════════
GET    /api/v1/inventory/warehouse        # Остатки на складе
GET    /api/v1/inventory/operator         # Инвентарь оператора
GET    /api/v1/inventory/machine          # Инвентарь машины
GET    /api/v1/inventory/low-stock        # Товары с низким запасом
POST   /api/v1/inventory/transfer         # Перемещение между уровнями
GET    /api/v1/inventory/movements        # История перемещений

# ════════════════════════════════════════════════════════════════════
# TASKS (10 endpoints)
# ════════════════════════════════════════════════════════════════════
GET    /api/v1/tasks                      # Все задачи
GET    /api/v1/tasks/my                   # Мои задачи
GET    /api/v1/tasks/:id                  # Детали задачи
POST   /api/v1/tasks                      # Создание задачи
PATCH  /api/v1/tasks/:id                  # Обновление задачи
POST   /api/v1/tasks/:id/start            # Начать выполнение
POST   /api/v1/tasks/:id/photo-before     # Загрузить фото "до"
POST   /api/v1/tasks/:id/photo-after      # Загрузить фото "после"
POST   /api/v1/tasks/:id/complete         # Завершить задачу
DELETE /api/v1/tasks/:id                  # Удалить задачу

# ════════════════════════════════════════════════════════════════════
# COMPLAINTS (21 endpoints)
# ════════════════════════════════════════════════════════════════════
POST   /api/v1/complaints                 # Создать жалобу
POST   /api/v1/complaints/public          # Публичная жалоба (QR)
GET    /api/v1/complaints                 # Список жалоб
GET    /api/v1/complaints/my              # Мои жалобы
GET    /api/v1/complaints/statistics      # Статистика жалоб
GET    /api/v1/complaints/:id             # Детали жалобы
GET    /api/v1/complaints/number/:number  # Жалоба по номеру
PATCH  /api/v1/complaints/:id             # Обновить жалобу
POST   /api/v1/complaints/:id/assign      # Назначить ответственного
POST   /api/v1/complaints/:id/resolve     # Разрешить жалобу
POST   /api/v1/complaints/:id/escalate    # Эскалировать
POST   /api/v1/complaints/:id/feedback    # Отзыв клиента
GET    /api/v1/complaints/:id/comments    # Комментарии к жалобе
POST   /api/v1/complaints/:id/comments    # Добавить комментарий
POST   /api/v1/complaints/:id/refunds     # Оформить возврат
POST   /api/v1/complaints/refunds/:id/approve  # Одобрить возврат
POST   /api/v1/complaints/refunds/:id/process  # Обработать возврат
POST   /api/v1/complaints/refunds/:id/reject   # Отклонить возврат
POST   /api/v1/complaints/qr-codes/generate    # Генерировать QR
GET    /api/v1/complaints/qr-codes/:code       # Получить QR
GET    /api/v1/complaints/templates       # Шаблоны ответов

# ════════════════════════════════════════════════════════════════════
# ORDERS (12 endpoints)
# ════════════════════════════════════════════════════════════════════
POST   /api/v1/orders                     # Создать заказ
GET    /api/v1/orders                     # Все заказы
GET    /api/v1/orders/my                  # Мои заказы
GET    /api/v1/orders/my/:id              # Мой заказ по ID
GET    /api/v1/orders/stats               # Статистика заказов
GET    /api/v1/orders/by-number/:number   # Заказ по номеру
GET    /api/v1/orders/:id                 # Детали заказа
POST   /api/v1/orders/:id/confirm         # Подтвердить заказ
POST   /api/v1/orders/:id/prepare         # Начать подготовку
POST   /api/v1/orders/:id/ready           # Готов к выдаче
POST   /api/v1/orders/:id/complete        # Завершить
POST   /api/v1/orders/:id/cancel          # Отменить

# ════════════════════════════════════════════════════════════════════
# LOYALTY (8 endpoints)
# ════════════════════════════════════════════════════════════════════
GET    /api/v1/loyalty/balance            # Баланс баллов
GET    /api/v1/loyalty/history            # История баллов
GET    /api/v1/loyalty/levels             # Уровни лояльности
GET    /api/v1/loyalty/levels/info        # Информация об уровнях
POST   /api/v1/loyalty/spend              # Потратить баллы
POST   /api/v1/loyalty/admin/adjust       # Корректировка (admin)
GET    /api/v1/loyalty/admin/stats        # Статистика (admin)
GET    /api/v1/loyalty/admin/expiring     # Истекающие баллы

# ════════════════════════════════════════════════════════════════════
# QUESTS (8 endpoints)
# ════════════════════════════════════════════════════════════════════
GET    /api/v1/quests                     # Все квесты
GET    /api/v1/quests/my                  # Мои квесты
GET    /api/v1/quests/my/:id              # Детали моего квеста
POST   /api/v1/quests/my/:id/claim        # Получить награду
POST   /api/v1/quests/my/claim-all        # Получить все награды
GET    /api/v1/quests/stats               # Статистика
POST   /api/v1/quests                     # Создать квест (admin)
DELETE /api/v1/quests/:id                 # Удалить квест (admin)

# ════════════════════════════════════════════════════════════════════
# REFERRALS (6 endpoints)
# ════════════════════════════════════════════════════════════════════
GET    /api/v1/referrals/my-code          # Мой реферальный код
POST   /api/v1/referrals/my-code/regenerate # Перегенерировать код
GET    /api/v1/referrals/summary          # Сводка по рефералам
GET    /api/v1/referrals/my               # Мои рефералы
POST   /api/v1/referrals/apply            # Применить реферальный код
GET    /api/v1/referrals/stats            # Статистика

# ════════════════════════════════════════════════════════════════════
# REPORTS (27 endpoints)
# ════════════════════════════════════════════════════════════════════
GET    /api/v1/reports/dashboard          # Dashboard данные
GET    /api/v1/reports/sales              # Отчёт по продажам
GET    /api/v1/reports/inventory          # Отчёт по инвентарю
GET    /api/v1/reports/machines           # Отчёт по машинам
GET    /api/v1/reports/definitions        # Определения отчётов
GET    /api/v1/reports/definitions/:id    # Определение по ID
POST   /api/v1/reports/definitions        # Создать определение
POST   /api/v1/reports/generate           # Генерировать отчёт
GET    /api/v1/reports/generated          # Сгенерированные отчёты
GET    /api/v1/reports/generated/:id      # Скачать отчёт
GET    /api/v1/reports/scheduled          # Запланированные отчёты
POST   /api/v1/reports/scheduled          # Создать расписание
PATCH  /api/v1/reports/scheduled/:id      # Обновить расписание
DELETE /api/v1/reports/scheduled/:id      # Удалить расписание
GET    /api/v1/reports/dashboards         # Все dashboards
GET    /api/v1/reports/dashboards/:id     # Dashboard по ID
POST   /api/v1/reports/dashboards         # Создать dashboard
PATCH  /api/v1/reports/dashboards/:id     # Обновить dashboard
DELETE /api/v1/reports/dashboards/:id     # Удалить dashboard
POST   /api/v1/reports/dashboards/:id/set-default # Установить по умолчанию
POST   /api/v1/reports/widgets            # Создать виджет
PATCH  /api/v1/reports/widgets/:id        # Обновить виджет
DELETE /api/v1/reports/widgets/:id        # Удалить виджет
POST   /api/v1/reports/dashboards/:id/reorder-widgets # Порядок виджетов
GET    /api/v1/reports/filters            # Сохранённые фильтры
POST   /api/v1/reports/filters            # Создать фильтр
DELETE /api/v1/reports/filters/:id        # Удалить фильтр

# ════════════════════════════════════════════════════════════════════
# USERS (5 endpoints)
# ════════════════════════════════════════════════════════════════════
GET    /api/v1/users                      # Список пользователей
GET    /api/v1/users/:id                  # Пользователь по ID
POST   /api/v1/users                      # Создать пользователя
PATCH  /api/v1/users/:id                  # Обновить пользователя
DELETE /api/v1/users/:id                  # Удалить пользователя

# ════════════════════════════════════════════════════════════════════
# LOCATIONS (6 endpoints)
# ════════════════════════════════════════════════════════════════════
GET    /api/v1/locations                  # Все локации
GET    /api/v1/locations/:id              # Локация по ID
GET    /api/v1/locations/nearby           # Локации рядом
POST   /api/v1/locations                  # Создать локацию
PATCH  /api/v1/locations/:id              # Обновить локацию
DELETE /api/v1/locations/:id              # Удалить локацию

# ════════════════════════════════════════════════════════════════════
# NOTIFICATIONS (5 endpoints)
# ════════════════════════════════════════════════════════════════════
GET    /api/v1/notifications              # Все уведомления
GET    /api/v1/notifications/my           # Мои уведомления
PATCH  /api/v1/notifications/:id/read     # Отметить как прочитанное
POST   /api/v1/notifications/read-all     # Прочитать все
POST   /api/v1/notifications              # Создать уведомление

# ════════════════════════════════════════════════════════════════════
# PAYMENTS (Payme, Click, Uzum)
# ════════════════════════════════════════════════════════════════════
POST   /api/v1/payments/payme/create      # Создать платёж Payme
POST   /api/v1/payments/click/create      # Создать платёж Click
POST   /api/v1/payments/uzum/create       # Создать платёж Uzum
POST   /api/v1/payments/qr/generate       # Генерировать QR для оплаты
POST   /api/v1/payments/webhook/payme     # Webhook Payme
POST   /api/v1/payments/webhook/click     # Webhook Click
POST   /api/v1/payments/webhook/uzum      # Webhook Uzum

# ════════════════════════════════════════════════════════════════════
# TELEGRAM BOT
# ════════════════════════════════════════════════════════════════════
POST   /api/v1/telegram-bot/webhook       # Telegram webhook

# ════════════════════════════════════════════════════════════════════
# TELEGRAM PAYMENTS
# ════════════════════════════════════════════════════════════════════
POST   /api/v1/telegram-payments          # Инициировать платёж Stars
GET    /api/v1/telegram-payments/:id      # Статус платежа

# ════════════════════════════════════════════════════════════════════
# FISCAL (MultiKassa)
# ════════════════════════════════════════════════════════════════════
POST   /api/v1/fiscal/z-report            # Создать Z-отчёт
GET    /api/v1/fiscal/reports             # История фискальных отчётов
GET    /api/v1/fiscal/devices             # Фискальные устройства
POST   /api/v1/fiscal/devices             # Зарегистрировать устройство
POST   /api/v1/fiscal/receipts            # Создать чек

# ════════════════════════════════════════════════════════════════════
# HEALTH CHECK
# ════════════════════════════════════════════════════════════════════
GET    /health                            # Liveness probe
GET    /ready                             # Readiness probe
```

**Всего endpoints: 150+**

---

*Документ создан: 26 января 2026*
*Версия: 2.0.0*
*Автор: AI Analysis (Claude)*
